require=function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){var l=typeof require=="function"&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);throw new Error("Cannot find module '"+o+"'")}var u=r[o]={exports:{}};t[o][0].call(u.exports,function(e){var r=t[o][1][e];return i(r?r:e)},u,u.exports,e,t,r,n)}return r[o].exports}var a=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){"use strict";e("./helpers");e("./core/title");e("./core/index");e("./core/loading");e("./core/message");e("./core/explore");e("./core/dashboard");e("./common/leaflet");e("./common/directives");e("./common/mapView");e("./session/app");e("./user/app");e("./import/app");e("./feature/app");e("./content/app");e("./layer/app");e("./map/app");var n=angular.extend({server:"local",apiPrefix:"/api/v1"},e("./config"));angular.module("mapasColetivos",["ui.router","ui.keypress","ui.slider","monospaced.elastic","ngRoute","ngAnimate","infinite-scroll","colorpicker.module","mapasColetivos.mapView","mapasColetivos.user","mapasColetivos.pageTitle","mapasColetivos.directives","mapasColetivos.session","mapasColetivos.index","mapasColetivos.dashboard","mapasColetivos.explore","mapasColetivos.loadingStatus","mapasColetivos.messageStatus","mapasColetivos.dataImport","mapasColetivos.map","mapasColetivos.layer","mapasColetivos.feature","mapasColetivos.content"]).value("config",n).value("apiPrefix",(n.server=="local"?"":n.server)+n.apiPrefix).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(e,t,r,i){if(n.server!=="local"){i.defaults.useXDomain=true;delete i.defaults.headers.common["X-Requested-With"]}t.otherwise("/");e.state("home",{url:"/",controller:"IndexCtrl",templateUrl:"/views/landing.html"});r.html5Mode(true);var a=["$rootScope","$q","$location",function(e,t,r){function n(e){return e}function i(e){var n=e.status;if(n==401){r.path("/login");return}return t.reject(e)}return function(e){return e.then(n,i)}}];i.responseInterceptors.push(a);t.rule(function(e,t){var r=t.path(),n=t.search(),i;if(r[r.length-1]==="/"){return}if(Object.keys(n).length===0){return r+"/"}i=[];angular.forEach(n,function(e,t){i.push(t+"="+e)});return r+"/?"+i.join("&")})}]).run(["$rootScope","$location",function(e,t){window.mcHistory=[];e.$on("$stateChangeSuccess",function(){if(window._gaq){window._gaq.push(["_trackPageview",t.path()])}window.mcHistory.push(window.location.pathname)})}])},{"./common/directives":2,"./common/leaflet":4,"./common/mapView":5,"./config":7,"./content/app":8,"./core/dashboard":12,"./core/explore":13,"./core/index":14,"./core/loading":15,"./core/message":16,"./core/title":17,"./feature/app":18,"./helpers":24,"./import/app":25,"./layer/app":30,"./map/app":37,"./session/app":41,"./user/app":44}],2:[function(e,t,r){"use strict";angular.module("mapasColetivos.directives",["ngSanitize","fitVids"]).directive("disableEnterKey",[function(){return{link:function(e,t){function r(){t.blur()}function n(e){if(e.which==13){r();e.preventDefault()}}t.on("keydown keypress",n)}}}]).directive("dynamic",["$compile",function(e){return function(t,r,n){t.$watch(function(e){return e.$eval(n.dynamic)},function(n){r.html(n);e(r.contents())(t)})}}])},{}],3:[function(e,t,r){"use strict";angular.module("mapasColetivos.geocode",[]).factory("GeocodeService",["$http",function(e){return{get:function(t){return e.jsonp("http://nominatim.openstreetmap.org/search.php?q="+t+"&format=json&polygon_geojson=1&json_callback=JSON_CALLBACK",{loadingMessage:"Buscando localizações"})}}}])},{}],4:[function(e,t,r){"use strict";angular.module("mapasColetivos.leaflet",[]).factory("MapService",[function(){var t=false,r=L.featureGroup(),n=[],i=[],a=[],o=L.mapbox.tileLayer("infoamazonia.h17kafbd"),s=L.mapbox.legendControl();var l=e("../feature/featureToMapObjService");return{init:function(e,n){this.destroy();t=L.mapbox.map(e,null,n);t.whenReady(function(){t.addLayer(o);t.addLayer(r);t.addControl(s);t.infoControl.addInfo('<a href="https://www.mapbox.com/map-feedback/" target="_blank" class="mapbox-improve-map">Melhore este mapa</a>')});return t},get:function(){return t},clearFeatures:function(){if(i.length){angular.forEach(i,function(e){if(r.hasLayer(e))r.removeLayer(e)});i=[]}},getFeatureLayer:function(){return r},addFeature:function(e){r.addLayer(e);i.push(e)},removeFeature:function(e){i=i.filter(function(t){return t!==e});r.removeLayer(e)},hideFeature:function(e){if(i.indexOf(e)!==-1){r.removeLayer(e);a.push(e);i=i.filter(function(t){return t!==e})}},showFeature:function(e){if(a.indexOf(e)!==-1){r.addFeature(e);i.push(e);a=i.filter(function(t){return t!==e})}},showAllFeatures:function(){if(a.length){angular.forEach(a,function(e){this.showFeature(e)})}},fitWorld:function(){t.setView([0,0],2)},fitFeatureLayer:function(){if(t instanceof L.Map){t.invalidateSize(false);if(i.length){t.fitBounds(r.getBounds())}}return t},addLayer:function(e){if(e.type=="TileLayer"){var e=this.addTileLayer(e.url);e.on("load",_.once(function(){s.addLegend(e._tilejson.legend)}));n.push(e)}else{var r=this;var i=[];var a=L.featureGroup();a.mcLayer=e;n.push(a);angular.forEach(e.features,function(t){var n=angular.copy(e.styles[t.geometry.type]);_.extend(n,t.properties||{});t.properties=n;var o=l(t,null,r.get());o.mcFeature=t;i.push(o);a.addLayer(o)});a.addTo(t);return{featureLayer:a,features:i}}},addTileLayer:function(e){if(e.indexOf("http://")!==-1){return L.tileLayer(e).addTo(t)}else{var r=L.mapbox.tileLayer(e);r.gridLayer=L.mapbox.gridLayer(e).addTo(t);r.gridControl=L.mapbox.gridControl(r.gridLayer).addTo(t);return r.addTo(t)}},renderTileJSON:function(e){if(e.legend){s.addLegend(e.legend)}if(e.center){t.setView([e.center[1],e.center[0]],e.center[2])}if(e.bounds){var r=L.latLngBounds(L.latLng(e.bounds[1],e.bounds[2]),L.latLng(e.bounds[3],e.bounds[0]));t.setMaxBounds(r)}if(e.maxZoom){t.options.maxZoom=e.maxZoom}if(e.minZoom){t.options.minZoom=e.minZoom}},removeBaseLayer:function(){t.removeLayer(o)},clearGroups:function(){var e=this;if(n.length){angular.forEach(n,function(r){if(t.hasLayer(r)){e.removeLayer(r)}})}n=[]},removeLayer:function(e){t.removeLayer(e);if(e._tilejson){e.gridControl.removeFrom(t);t.removeLayer(e.gridLayer)}},clearAll:function(){this.clearFeatures();this.clearGroups()},destroy:function(){this.clearAll();o=L.mapbox.tileLayer("infoamazonia.h17kafbd");s=L.mapbox.legendControl();if(t instanceof L.Map)t.remove();t=null}}}])},{"../feature/featureToMapObjService":21}],5:[function(e,t,r){"use strict";angular.module("mapasColetivos.mapView",[]).factory("MapView",["MapService",function(e){var t=true;var r=false;return{sidebar:function(r){if(typeof r!=="undefined"){t=r;setTimeout(function(){if(e.get())e.get().invalidateSize()},200)}return t},backLink:function(e){if(typeof e!=="undefined"){r=e}return r}}}]).controller("MapViewCtrl",["$scope","$rootScope","$location","MapView",function(e,t,r,n){e.mapView=n;t.$on("$stateChangeSuccess",function(e,t,r,i,a){if(i.name.indexOf("singleMap")==-1&&i.name.indexOf("singleLayer")==-1){n.backLink(window.mcHistory[window.mcHistory.length-2])}});e.mapView.goBack=function(){if(n.backLink()){r.path(n.backLink())}}}])},{}],6:[function(e,t,r){"use strict";angular.module("mapasColetivos.sirTrevor",[]).directive("sirTrevorEditor",["apiPrefix",function(e){return{link:function(t,r,n){SirTrevor.setDefaults({uploadUrl:e+"/images"});t.sirTrevor=new SirTrevor.Editor({el:jQuery(r),blockTypes:["Embedly","Text","List","Image","Video"],defaultType:"Text",required:"Text"})}}}]).factory("SirTrevor",[function(){var e={vimeo:{regex:/(?:http[s]?:\/\/)?(?:www.)?vimeo.com\/(.+)/,html:'<iframe src="{{protocol}}//player.vimeo.com/video/{{remote_id}}?title=0&byline=0" width="580" height="320" frameborder="0"></iframe>'},youtube:{regex:/(?:http[s]?:\/\/)?(?:www.)?(?:(?:youtube.com\/watch\?(?:.*)(?:v=))|(?:youtu.be\/))([^&].+)/,html:'<iframe src="{{protocol}}//www.youtube.com/embed/{{remote_id}}" width="580" height="320" frameborder="0" allowfullscreen></iframe>'}};return{render:function(e){var t=this;var r="";angular.forEach(e,function(e){r+=t.renderBlock(e)});return r},renderBlock:function(t){var r="";if(typeof t!=="undefined"&&t){switch(t.type){case"text":r+='<div class="text">'+markdown.toHTML(t.data.text)+"</div>";break;case"list":r+='<div class="list">'+markdown.toHTML(t.data.text)+"</div>";break;case"image":r+='<div class="image"><img src="'+t.data.file.url+'" /></div>';break;case"video":r+='<div class="video" fit-vids>'+e[t.data.source].html.replace("{{protocol}}",window.location.protocol).replace("{{remote_id}}",t.data.remote_id)+"</div>";break}}return r}}}])},{}],7:[function(e,t,r){"use strict";var n={server:"local",apiPrefix:"/api/v1"};t.exports=n},{}],8:[function(e,t,r){"use strict";e("../common/sirTrevor");angular.module("mapasColetivos.content",["mapasColetivos.sirTrevor"]).factory("Content",e("./service").Content).controller("ContentCtrl",e("./controller").ContentCtrl).controller("ContentEditCtrl",e("./editController").ContentEditCtrl)},{"../common/sirTrevor":6,"./controller":9,"./editController":10,"./service":11}],9:[function(e,t,r){"use strict";r.ContentCtrl=["$scope","$rootScope","$stateParams","SirTrevor","Content","Feature","SessionService","MessageService",function(e,t,r,n,i,a,o,s){e.objType="content";e.$content=i;var l,u;t.$on("data.ready",function(r,n){l=i.get();u=a.get();e.$watch("features.updated",function(e){e=e});e.$watch("contents.updated",function(e){e=e});var o=true;e.$watch("$content.get()",function(r){if(typeof r!=="undefined"&&r){e.contents=r;t.$broadcast("contents.updated",r);if(o){c();o=false}}})});e.renderBlock=function(e){return n.renderBlock(e)};var c=function(){if(r.contentId&&e.contents){var t=e.contents.filter(function(e){return e._id==r.contentId})[0];e.view(t);return true}return false};var f=false;e.view=function(r){f=true;if(!r)return false;var n=i.getFeatures(r,u);if(n){a.set(n)}t.$broadcast("content.filtering.started",r,n);e.content=r;e.content.featureObjs=n};e.close=function(){if(typeof u!=="undefined")a.set(u);e.content=false;f=false;t.$broadcast("content.filtering.closed")};e.new=function(){i.edit({})};e.canEdit=function(e,t){var r=e.creator._id?e.creator._id:e.creator;if(r==o.user._id){return true}if(t.creator._id==o.user._id){return true}return false};e.edit=function(t,r){if(e.canEdit(t,r)){i.edit(angular.copy(t));setTimeout(function(){window.dispatchEvent(new Event("resize"));document.getElementById("content-edit-body").scrollTop=0},100)}else{s.add({status:"error",text:"Você não tem permissão para editar este conteúdo"})}};t.$on("$stateChangeSuccess",function(){if(!c()&&f){e.close()}});e.templates={list:"/views/content/list-item.html",show:"/views/content/show.html"};e.$on("$stateChangeStart",e.close)}]},{}],10:[function(e,t,r){"use strict";r.ContentEditCtrl=["$scope","$rootScope","Content","Layer","MessageService","SirTrevor","MapService",function(e,t,r,n,i,a,o){var s,l;e.$layer=n;e.$watch("$layer.edit()",function(e){l=e});e.$content=r;e.$watch("$content.get()",function(t){e.contents=t});e.$watch("$content.edit()",function(t){e.editing=t});e.$watch("editing",function(t){s=angular.copy(t);e.tool=false});e.$watch("editing.sirTrevor",function(t){setTimeout(function(){e.sirTrevor.reinitialize()},20)});e.save=function(){e.sirTrevor.onFormSubmit();e.editing.type="Post";e.editing.sirTrevorData=e.sirTrevor.dataStore.data;e.editing.sirTrevor=e.sirTrevor.el.value;if(e.editing&&e.editing._id){r.resource.update({contentId:e.editing._id},e.editing,function(t){e.editing=angular.copy(t);s=angular.copy(t);angular.forEach(e.contents,function(t,r){if(t._id==e.editing._id)e.contents[r]=e.editing});r.set(e.contents);i.message({status:"ok",text:"Conteúdo salvo."})})}else{e.editing.layer=l._id;var t=new r.resource(e.editing);t.$save(function(t){s=angular.copy(t);e.contents.push(t);r.set(e.contents);r.edit(angular.copy(t));i.message({status:"ok",text:"Conteúdo adicionado."})},function(e){var t={status:"error"};if(e.status==400&&e.data.message){t.text=e.data.message}else{t.text="Ocorreu um erro interno."}i.message(t,false)})}};e.delete=function(){if(confirm("Você tem certeza que deseja remover este conteúdo?")){r.resource.delete({contentId:e.editing._id},function(){r.set(e.contents.filter(function(t){return t._id!==e.editing._id}));r.edit(false);i.message({status:"ok",text:"Conteúdo removido."})},function(e){var t={status:"error"};if(e.status==400&&e.data.message){t.text=e.data.message}else{t.text="Ocorreu um erro interno."}i.message(t,false)})}};e.close=function(){if(e.editing){r.edit(false);setTimeout(function(){o.fitFeatureLayer()},200)}};e.hasFeature=function(t){if(e.editing&&e.editing.features){return e.editing.features.filter(function(e){return e==t}).length}return false};e.toggleFeature=function(t){if(!e.editing.features)e.editing.features=[];var r=angular.copy(e.editing.features);if(e.hasFeature(t)){r=r.filter(function(e){return e!==t})}else{r.push(t)}e.editing.features=r};e.clearFeatures=function(){e.editing.features=[]};e.tool=false;e.setTool=function(t){if(t==e.tool)e.tool=false;else e.tool=t};e.isRevertable=function(){return!angular.equals(e.editing,s)&&e.editing&&e.editing._id};e.revert=function(){e.editing=angular.copy(s)};e.$on("layerObjectChange",e.close);e.$on("$stateChangeStart",e.close);e.$on("layer.save.success",function(){if(e.editing){e.save(true)}})}]},{}],11:[function(e,t,r){"use strict";r.Content=["$resource","apiPrefix",function(e,t){var r=[];var n=false;return{resource:e(t+"/contents/:contentId",{},{query:{method:"GET",isArray:false,loadingMessage:"Carregando conteúdos"},get:{method:"GET",loadingMessage:"Carregando conteúdo"},save:{method:"POST",loadingMessage:"Criando conteúdo",url:t+"/contents",params:{layer:"@id"}},"delete":{method:"DELETE",loadingMessage:"Removendo conteúdo",url:t+"/contents/:contentId"},update:{method:"PUT",loadingMessage:"Atualizando conteúdo"}}),set:function(e){r=e;r=_.sortBy(r,function(e){return e.createdAt}).reverse()},add:function(e){r.push(e)},get:function(){return r},edit:function(e){if(typeof e!=="undefined")n=e;return n},getFeatures:function(e,t){if(e.features.length){if(t&&t.length){var r=t.filter(function(t){return e.features.indexOf(t._id)!==-1});return r}}return false}}}]},{}],12:[function(e,t,r){"use strict";angular.module("mapasColetivos.dashboard",[]).config(["$stateProvider",function(e){e.state("dashboard",{url:"/dashboard/",controller:"DashboardCtrl",templateUrl:"/views/dashboard/index.html"}).state("dashboard.profile",{url:"profile/",templateUrl:"/views/dashboard/profile.html"})}]).controller("DashboardCtrl",["$scope","$rootScope","$timeout","$state","$stateParams","SessionService","$location","Page","User","Layer","Map",function(e,t,r,n,i,a,o,s,l,u,c){s.setTitle("Painel de Controle");e.isDashboard=true;e.$session=a;e.$watch("$session.authenticated()",function(e){if(!e){o.path("/login/")}});e.$watch("$session.user()",function(t){if(t){e.user=t;e.user.grvtr=l.gravatar(e.user.email,100)}});var f=function(){if(n.current.name==="dashboard"){o.path("/dashboard/layers").replace()}e.currentState=n.current.name.replace("dashboard.","")};t.$on("$viewContentLoaded",function(){f()});t.$on("$stateChangeSuccess",function(){f()});e.$layer=u;u.resource.userLayers(function(t){e.totalLayer=t.layersTotal;e.layers=t.layers;e.$on("layer.page.next",function(t,r){if(r.layers.length){angular.forEach(r.layers,function(t){e.layers.push(t)});e.layers=e.layers}})});e.$map=c;c.resource.userMaps(function(t){e.totalMap=t.mapsTotal;e.maps=t.maps;e.$on("map.page.next",function(t,r){if(r.maps.length){angular.forEach(r.maps,function(t){e.maps.push(t)});e.maps=e.maps}})});t.$on("map.delete.success",function(t,r){e.maps=e.maps.filter(function(e){return r._id!=e._id})});t.$on("layer.add.success",function(t,r){e.layers=[r].concat(e.layers)});t.$on("layer.delete.success",function(t,r){e.layers=e.layers.filter(function(e){return r._id!=e._id})})}])},{}],13:[function(e,t,r){"use strict";angular.module("mapasColetivos.explore",[]).config(["$stateProvider",function(e){e.state("explore",{url:"/explore/",controller:"ExploreCtrl",templateUrl:"/views/explore.html"})}]).controller("ExploreCtrl",["$scope","Page","Layer","Map",function(e,t,r,n){t.setTitle("Explore a comunidade");r.resource.get({perPage:4},function(t){e.layers=t.layers});n.resource.get({perPage:4},function(t){e.maps=t.maps})}])},{}],14:[function(e,t,r){"use strict";angular.module("mapasColetivos.index",[]).controller("IndexCtrl",["$scope","SessionService","$location",function(e,t,r){e.$session=t;e.$watch("$session.authenticated()",function(e){if(e)r.path("/dashboard/")});e.$on("$stateChangeSuccess",function(){if(r.path()=="/"){angular.element("html").addClass("landing")}});e.$on("$stateChangeStart",function(){angular.element("html").removeClass("landing")})}])},{}],15:[function(e,t,r){"use strict";angular.module("mapasColetivos.loadingStatus",[]).config(["$httpProvider",function(e){e.interceptors.push("loadingStatusInterceptor")}]).service("LoadingService",function(){var e=false;var t="Carregando...";var r=true;return{show:function(n){if(r){if(typeof n!=="undefined")t=n;e=true;return e}},hide:function(){if(r){t="Carregando...";e=false;return e}},get:function(){return e},setMessage:function(e){t=e},getMessage:function(){return t},disable:function(){r=false},enable:function(){r=true}}}).directive("loadingStatusMessage",["LoadingService",function(e){return{link:function(t,r,n){var i=function(){r.addClass("active").find(".loading-message").html(e.getMessage())};var a=function(){r.removeClass("active")};t.$service=e;t.$watch("$service.get()",function(e){if(e)i();else a()})}}}]).factory("loadingStatusInterceptor",["$q","$rootScope","$timeout","LoadingService",function(e,t,r,n){var i="Carregando...";var a=0;var o=function(){if(a==0){n.setMessage(i);n.show();t.$broadcast("loadingStatusActive",i)}a++};var s=function(){a--;if(a==0){n.hide();t.$broadcast("loadingStatusInactive",i)}};return{request:function(t){if(t.loadingMessage)i=t.loadingMessage;else i="Carregando...";o();return t||e.when(t)},response:function(t){s();return t||e.when(t)},responseError:function(t){s();return e.reject(t)}}}])},{}],16:[function(e,t,r){"use strict";angular.module("mapasColetivos.messageStatus",[]).config(["$httpProvider",function(e){e.interceptors.push("MessageInterceptor")}]).factory("MessageService",["$timeout",function(e){var t=[];var r=true;return{get:function(){return t},close:function(e){t=t.filter(function(t){return t!==e})},add:function(n,i){if(r){var a=this;if(typeof n!=="undefined"){var o=n;t.push(o);if(i!==false){i=i?i:3e3;e(function(){a.close(o)},i)}}}return o},message:function(e,t){this.add(e,t)},disable:function(){r=false},enable:function(){r=true}}}]).factory("MessageInterceptor",["$q","$rootScope","$timeout","MessageService",function(e,t,r,n){return{request:function(t){return t||e.when(t)},response:function(t){if(t.data&&t.data.messages){angular.forEach(t.data.messages,function(e){n.add(e)})}return t||e.when(t)},responseError:function(t){if(t.data&&t.data.messages){angular.forEach(t.data.messages,function(e){n.add(e)})}return e.reject(t)}}}]).controller("MessageCtrl",["$scope","MessageService",function(e,t){e.service=t;e.$watch("service.get()",function(t){e.messages=t});e.close=function(t){e.service.close(t)}}])},{}],17:[function(e,t,r){"use strict";angular.module("mapasColetivos.pageTitle",[]).factory("Page",[function(){var e="Mapas Coletivos";var t=e;return{title:function(){return t},setTitle:function(r){t=r+" - "+e}}}]).controller("PageCtrl",["$scope","Page",function(e,t){e.page=t}])},{}],18:[function(e,t,r){"use strict";angular.module("mapasColetivos.feature",[]).factory("Feature",e("./service").Feature).factory("Maki",e("./makiService").Maki).controller("FeatureCtrl",e("./controller").FeatureCtrl).controller("FeatureEditCtrl",e("./editController").FeatureEditCtrl)},{"./controller":19,"./editController":20,"./makiService":22,"./service":23}],19:[function(e,t,r){"use strict";var n=e("./featureToMapObjService");r.FeatureCtrl=["$scope","$rootScope","$state","$stateParams","$location","Feature","Content","MessageService","MapService","SessionService",function(e,t,r,i,a,o,s,l,u,c){e.$session=c;e.$watch("$session.user()",function(t){e.user=t});e.objType="feature";e.$feature=o;var f,d;t.$on("data.ready",function(){f=s.get();d=o.get();var r=true;e.$watch("$feature.get()",function(n){if(typeof n!=="undefined"&&n){e.features=n;t.$broadcast("features.updated",n);if(r){p();r=false}}})});var h=false;var g=false;e.focus=function(e){setTimeout(function(){var t=n(e);u.get().fitBounds(L.featureGroup([t]).getBounds());g=true},100)};e.view=function(r){e.close();h=true;e.feature=r;if(window.mcHistory.length==1){setTimeout(function(){var e=n(r);u.get().fitBounds(L.featureGroup([e]).getBounds());g=true},200)}var i=o.getContents(r,f);s.set(i);t.$broadcast("feature.filtering.started",r,i)};e.description=function(e){if(e&&e.description){var t=angular.copy(e.description);t=t.replace(new RegExp("{{","g"),"<%= ");t=t.replace(new RegExp("}}","g")," %>");var r=_.template(t);return markdown.toHTML(r(e.properties))}return""};e.close=function(){e.feature=false;if(typeof d!=="undefined"&&o.get()!==d)o.set(d);if(typeof f!=="undefined"&&s.get()!==f)s.set(f);h=false;if(g){g=false;u.fitFeatureLayer()}t.$broadcast("feature.filtering.closed")};e.templates={list:"/views/feature/list-item.html",show:"/views/feature/show.html"};var p=function(){if(i.featureId&&e.features){var t=e.features.filter(function(e){return e._id==i.featureId})[0];if(t){e.view(t);return true}}return false};t.$on("$stateChangeSuccess",function(){if(!p()&&h){e.close()}});if(a.path().indexOf("edit")!==-1){e.canEdit=function(t,r){var n=t.creator._id?t.creator._id:t.creator;if(n==e.user._id){return true}if(r.creator._id==e.user._id){return true}return false};e.$on("marker.clicked",function(t,r,n){e.edit(r,n)});e.new=function(){o.edit({})};e.edit=function(t,r){if(e.canEdit(t,r)){o.edit(angular.copy(t));setTimeout(function(){window.dispatchEvent(new Event("resize"))},100)}else{l.add({status:"error",text:"Você não tem permissão para editar este local"})}}}}]},{"./featureToMapObjService":21}],20:[function(e,t,r){"use strict";var n=e("./featureToMapObjService");r.FeatureEditCtrl=["$scope","$rootScope","$timeout","Feature","Maki","Layer","MessageService","GeocodeService","MapService",function(e,t,r,i,a,o,s,l,u){var c;var f;e.$layer=o;e.$watch("$layer.edit()",function(t){c=t;var r=u.get();if(r){r.on("draw:created",function(t){e.drawing=false;e.editing.geometry=t.layer.toGeoJSON().geometry;h(e.editing)})}});e.$feature=i;e.$watch("$feature.get()",function(t){e.features=t});var d;var h=function(r){e.tool=false;e.marker=false;e._data={};e.editing=angular.copy(r);d=angular.copy(r);if(f){f.disable()}if(r){e.setMarker();if(e.editing.geometry&&r.geometry.type=="Point"&&!r.geometry.coordinates){u.get().on("click",g)}else{if(u.get())u.get().off("click",g)}t.$broadcast("feature.edit.start",r)}else{t.$broadcast("feature.edit.stop")}if(u.get()){window.dispatchEvent(new Event("resize"));setTimeout(function(){u.get().invalidateSize(false);window.dispatchEvent(new Event("resize"))},300)}};e.$watch("$feature.edit()",h);e._data={};e.marker=false;e.defaults={scrollWheelZoom:false};e.newFeature=function(t){i.edit({geometry:{type:t},properties:{}});e.setMarker(false)};var g=function(t){var t=t.latlng;if(!e.marker){e.editing.geometry.coordinates=[t.lng,t.lat];h(e.editing)}};e.setMarker=function(t){var r=u.get();if(!r)return false;u.clearFeatures();if(e.editing){if(e.editing.geometry){if(e.editing.geometry.coordinates){e.marker=n(e.editing,{draggable:true});if(e.editing.geometry.type=="Point"){e.marker.bindPopup('<p class="tip">Arraste para alterar a localização.</p>').on("dragstart",function(){e.marker.closePopup()}).on("drag",function(){e.marker.closePopup();var t=e.marker.getLatLng();e.editing.geometry.coordinates=[t.lng,t.lat]});e.marker.openPopup();if(t!==false){window.dispatchEvent(new Event("resize"));setTimeout(function(){window.dispatchEvent(new Event("resize"));r.invalidateSize(true);r.setView(e.marker.getLatLng(),15,{reset:true});r.invalidateSize(true)},200)}}else{if((e.editing.source=="local"||!e.editing.source)&&_.flatten(e.editing.geometry.coordinates).length<250){e.marker.editing.enable();e.marker.on("edit",function(t){e.editing.geometry=t.target.toGeoJSON().geometry})}if(t!==false){window.dispatchEvent(new Event("resize"));setTimeout(function(){window.dispatchEvent(new Event("resize"));r.invalidateSize(false);r.fitBounds(e.marker.getBounds())},300)}}u.addFeature(e.marker)}else{switch(e.editing.geometry.type){case"LineString":f=new L.Draw.Polyline(r,{shapeOptions:{stroke:true,color:"#555",weight:4,opacity:.5,fill:false,clickable:true}});f.enable();break;case"Polygon":f=new L.Draw.Polygon(r,{shapeOptions:{stroke:true,color:"#555",weight:4,opacity:.5,fill:true,clickable:true}});f.enable();break}}}}};e.save=function(r){e.$emit("feature.save.init",e.editing);if(e.editing&&e.editing._id){i.resource.update({featureId:e.editing._id,layerId:c._id},e.editing,function(n){angular.forEach(e.features,function(t,r){if(t._id==e.editing._id)e.features[r]=e.editing});i.set(e.features);t.$broadcast("features.updated");if(r!==true){s.message({status:"ok",text:"Feature salva."});i.edit(false)}else{i.edit(angular.copy(e.editing))}})}else{var n=new i.resource(e.editing);n.$save({layerId:c._id},function(r){e.features.push(r);i.set(e.features);i.edit(angular.copy(r));t.$broadcast("features.updated");s.message({status:"ok",text:"Feature adicionada."})})}};e.delete=function(){if(confirm("Você tem certeza que deseja remover esta feature?")){i.resource.delete({featureId:e.editing._id,layerId:c._id},function(r){i.set(e.features.filter(function(t){return t._id!==e.editing._id}));t.$broadcast("features.updated");s.message({status:"ok",text:"Feature removida."});i.edit(false)})}};e.tool=false;e.setTool=function(t){if(t==e.tool)e.tool=false;else e.tool=t};e.geocode=function(){l.get(e._data.geocode).success(function(t){e._data.geocodeResults=t}).error(function(t){e._data.geocodeResults=[]})};e.setNominatimFeature=function(t,r){e.editing.source="osm";if(!e.editing.properties)e.editing.properties={};if(!e.editing.title)e.editing.title=t.display_name;if(r=="geojson"){e.editing.geometry=t.geojson}else{e.editing.geometry={type:"Point",coordinates:[parseFloat(t.lon),parseFloat(t.lat)]}}h(e.editing)};e.properties=[];e.reservedProperties=[];e.isReservedProperty=function(t){if(e.reservedProperties.indexOf(t)!==-1)return true;return false};e.removeProperty=function(t){var r=[];angular.forEach(e.properties,function(e,n){if(e._id!==t){r.push({_id:n,key:e.key,val:e.val})}});e.properties=r};e.removePropertyByKey=function(t){var r=[];angular.forEach(e.properties,function(e,n){if(e.key!==t){r.push({_id:n,key:e.key,val:e.val})}});e.properties=r};e.addProperty=function(t,r){if(typeof t=="undefined")t="";if(typeof r=="undefined")r="";e.properties.push({_id:e.properties.length,key:t,val:r});e.properties=e.properties};var p=function(t){return _.find(e.properties,function(e){return e.key==t})};var y=function(t){for(var r in t){e.updateProperty(r,t[r])}e.properties=e.properties};var m=function(t,r){if(p(t)){p(t).val=r}else{e.addProperty(t,r)}};e.$watch("editing",function(t){if(t){var r=t.properties;e.properties=[];var n=0;if(r){for(var i in r){e.properties.push({_id:n,key:i,val:r[i]});n++}}e.properties=e.properties}});var v=function(){if(e.editing){var t={};if(e.properties.length){angular.forEach(e.properties,function(e){t[e.key]=e.val})}e.editing.properties=angular.copy(t)}};var w=e.$on("feature.save.init",v);e.$on("$destroy",w);var b;e.$watch("$layer.edit()",function(e){if(e){b=e.styles}},true);e.reservedProperties=e.reservedProperties.concat(["marker-size","marker-color","marker-symbol","stroke","stroke-width","stroke-opacity","fill","fill-opacity","customStyle"]);e.maki=a.maki;e.makiSprite=a.makiSprite;var x=function(){if(e.editing.geometry.type=="Point"){e.marker.setIcon(L.mapbox.marker.icon(e.editing.styles))}else{e.marker.setStyle(L.mapbox.simplestyle.style({properties:e.editing.styles}))}};var k=e.$on("feature.edit.start",function(t,r){if(r&&r.properties&&r.geometry&&r.geometry.type&&b){if(!r.properties.customStyle){r.styles=_.extend(r.styles||{},b[r.geometry.type])}else{r.styles=r.properties}e.editing.styles=r.styles}if(e.marker){x()}});e.$on("$destroy",k);e.$watch("editing.styles",_.debounce(function(t,r){if(e.editing&&e.editing.geometry&&e.editing.geometry.coordinates){var n=angular.copy(b[e.editing.geometry.type]);if(t===false){e.editing.styles=n;window.dispatchEvent(new Event("resize"));delete e.editing.properties.customStyle;e.editing=e.editing;e.removePropertyByKey("customStyle")}if(angular.equals(t,n)){for(var i in n){e.removePropertyByKey(i)}e.removePropertyByKey("customStyle")}else{for(var i in n){m(i,t[i])}m("customStyle",1)}x()}},150),true);var $=e.$on("layer.save.success",function(){if(e.editing){e.save(true)}});e.$on("$destroy",$)}]},{"./featureToMapObjService":21}],21:[function(e,t,r){"use strict";t.exports=function(e,t,r){var n=false;if(e.geometry&&e.geometry.coordinates){if(!e.properties){e.properties={}}var i=angular.copy(e.geometry.coordinates);var a=i;if(e.geometry.type=="Polygon"){var a=[];_.each(i[0],function(e){e.splice(2,1);a.push(e.reverse())});n=L.polygon(a,L.mapbox.simplestyle.style(e))}else if(e.geometry.type=="LineString"){a=[];_.each(i,function(e){e.splice(2,1);a.push(e.reverse())});n=L.polyline(a,L.mapbox.simplestyle.style(e))}else if(e.geometry.type=="Point"){t=angular.extend({icon:L.mapbox.marker.icon(e.properties)},t);i.splice(2,1);a=i.reverse();n=L.marker(a,t)}}if(n&&r){var o={};if(e.geometry.type!=="Point")o.autoPan=false;var s=L.popup(o).setContent('<h3 class="feature-title">'+e.title+"</h3>");var l=function(e){s.setLatLng(e.latlng)};n.on("mouseover",function(){n.openPopup();if(e.geometry.type!=="Point")r.on("mousemove",l)}).on("mouseout",function(){n.closePopup();if(e.geometry.type!=="Point")r.off("mousemove",l)}).bindPopup(s)}return n}},{}],22:[function(e,t,r){"use strict";r.Maki=[function(){var t=e("maki/_includes/maki.json");var r=e("maki/www/maki-sprite.json");return{maki:t,makiSprite:function(e){var t=r[e+"-24"];return"background-position: -"+t.x+"px -"+t.y+"px;"+"width:"+t.width+"px;"+"height:"+t.height+"px;"}}}]},{"maki/_includes/maki.json":55,"maki/www/maki-sprite.json":56}],23:[function(e,t,r){"use strict";r.Feature=["$resource","apiPrefix",function(e,t){var r=[],n=false,i=false;return{resource:e(t+"/features/:featureId",{},{query:{method:"GET",isArray:false,loadingMessage:"Carregando locais"},get:{method:"GET",loadingMessage:"Carregando local"},"import":{method:"POST",isArray:true,loadingMessage:"Importando dados",url:t+"/layers/:layerId/features/import"},save:{method:"POST",loadingMessage:"Criando local",url:t+"/layers/:layerId/features"},"delete":{method:"DELETE",loadingMessage:"Removendo local",url:t+"/layers/:layerId/features/:featureId"},update:{method:"PUT",loadingMessage:"Atualizando local"}}),set:function(e){r=e},add:function(e){r.push(e)},get:function(){return r},edit:function(e){if(typeof e!=="undefined")i=e;return i},getContents:function(e,t){if(e.contents.length){if(t&&t.length){var r=t.filter(function(t){return e.contents.indexOf(t._id)!==-1});return r}}return false}}}]},{}],24:[function(e,t,r){if(!Array.prototype.filter){Array.prototype.filter=function(e){"use strict";if(this===void 0||this===null)throw new TypeError;var t=Object(this);var r=t.length>>>0;if(typeof e!="function")throw new TypeError;var n=[];var i=arguments.length>=2?arguments[1]:void 0;for(var a=0;a<r;a++){if(a in t){var o=t[a];if(e.call(i,o,a,t))n.push(o)}}return n}}},{}],25:[function(e,t,r){"use strict";angular.module("mapasColetivos.dataImport",[]).directive("importInput",e("./directive").ImportInput).directive("importInputTrigger",e("./directive").ImportInputTrigger).controller("DataImportCtrl",e("./controller").DataImportCtrl)},{"./controller":26,"./directive":27}],26:[function(e,t,r){"use strict";var n=e("./readfile");
r.DataImportCtrl=["$scope","$rootScope","$location","Layer","Feature","MessageService",function(e,t,r,i,a,o){var s=e.$on("import.input.change",function(e,t){l(t)});e.$on("$destroy",function(){s()});function l(e){var t=e.files;if(!(t&&t[0]))return;n.readAsText(t[0],function(e,r){n.readFile(t[0],r,u)})}function u(e,t,n){if(e){o.add({status:"error",text:e.message})}else{if(!i.edit()){var a=new i.resource({title:"Untitled",type:"FeatureLayer",isDraft:false});a.$save(function(e){c(e.layer,t,function(){r.path("/layers/"+e.layer._id+"/edit/")})})}else{var s=i.edit();c(s,t,function(){if(s.isDraft){s.isDraft=false;delete s.features;delete s.contents;i.resource.update({layerId:s._id},s,function(e){window.location.reload()})}else{window.location.reload()}})}}}function c(e,t,r){var n=[];angular.forEach(t.features,function(e){if(e.geometry){if(e.properties.title&&typeof e.properties.title=="string")e.title=e.properties.title;else if(e.properties.name&&typeof e.properties.name=="string")e.title=e.properties.name;else e.title="Untitled";if(e.geometry.type=="GeometryCollection"&&e.geometry.geometries){angular.forEach(e.geometry.geometries,function(t){var r=angular.copy(e);r.geometry=t;n.push(r)})}else{n.push(e)}}});a.resource.import({layerId:e._id},n,r)}}]},{"./readfile":28}],27:[function(e,t,r){"use strict";r.ImportInput=["$rootScope",function(e){return{restrict:"A",link:function(e,t,r){angular.element(t).on("change",function(){e.$emit("import.input.change",this)})}}}];r.ImportInputTrigger=[function(){return{restrict:"A",link:function(e,t,r){angular.element(t).on("click",function(){angular.element("#"+r.importInputTrigger).trigger("click")})}}}]},{}],28:[function(e,t,r){var n=e("topojson"),i=e("togeojson"),a=e("csv2geojson"),o=e("osmtogeojson");t.exports.readDrop=s;t.exports.readAsText=l;t.exports.readFile=u;function s(e){return function(){var t=[];var r=[];var n=[];if(d3.event.dataTransfer&&d3.event.dataTransfer&&d3.event.dataTransfer.files&&d3.event.dataTransfer.files.length){d3.event.stopPropagation();d3.event.preventDefault();var i=d3.event.dataTransfer.files.length;[].forEach.call(d3.event.dataTransfer.files,function(e){l(e,function(n,o){if(n){r.push(n);if(!--i)a(r,t)}else{u(e,o,function(e,n,o){if(e)r.push(e);if(n)t.push(n);if(o)t.push(o);if(!--i)a(r,t,o)})}})})}else{return e({message:"No files were dropped"})}function a(t,r,n){if(!r.length&&t.length)return e(t[0],null,n);return e(null,{type:"FeatureCollection",features:r.reduce(function(e,t){if(t.features)e=e.concat(t.features);else if(t.type==="Feature")e.push(t);return e},[])},n)}}}function l(e,t){try{var r=new FileReader;r.readAsText(e);r.onload=function(e){if(e.target&&e.target.result)t(null,e.target.result);else t({message:"Dropped file could not be loaded"})};r.onerror=function(e){t({message:"Dropped file was unreadable"})}}catch(n){t({message:"Dropped file was unreadable"})}}function u(e,t,r){var s=w(e);if(!s){var l=e.name?e.name.toLowerCase():"",u=l.split(".");return r({message:"Could not detect file type"})}else if(s==="kml"){var c=v(t);if(!c){return r({message:"Invalid KML file: not valid XML"})}var f;if(c.getElementsByTagName("NetworkLink").length){f={message:"The KML file you uploaded included NetworkLinks: some content may not display. "+"Please export and upload KML without NetworkLinks for optimal performance"}}r(null,i.kml(c),f)}else if(s==="xml"){var d=v(t),h;if(!d){return r({message:"Invalid XML file: not valid XML"})}h=o.toGeojson(d);h.features.forEach(function(e){e.properties=e.properties.tags});r(null,h)}else if(s==="gpx"){r(null,i.gpx(v(t)))}else if(s==="geojson"){try{gj=JSON.parse(t);if(gj&&gj.type==="Topology"&&gj.objects){var g={type:"FeatureCollection",features:[]};for(var p in gj.objects){var y=n.feature(gj,gj.objects[p]);if(y.features)g.features=g.features.concat(y.features);else g.features=g.features.concat([y])}return r(null,g)}else{return r(null,gj)}}catch(m){alert("Invalid JSON file: "+m);return}}else if(s==="dsv"){a.csv2geojson(t,{delimiter:"auto"},function(e,n){if(e){return r({type:"geocode",result:n,raw:t})}else{return r(null,n)}})}function v(e){return(new DOMParser).parseFromString(e,"text/xml")}function w(e){var t=e.name?e.name.toLowerCase():"";function r(e){return t.indexOf(e)!==-1}if(e.type==="application/vnd.google-earth.kml+xml"||r(".kml")){return"kml"}if(r(".gpx"))return"gpx";if(r(".geojson")||r(".json")||r(".topojson"))return"geojson";if(e.type==="text/csv"||r(".csv")||r(".tsv")||r(".dsv")){return"dsv"}if(r(".xml")||r(".osm"))return"xml"}}},{csv2geojson:52,osmtogeojson:57,togeojson:63,topojson:"BOmyIj"}],29:[function(e,t,r){"use strict";r.LayerActionsCtrl=["$rootScope","$scope","$q","$location","MessageService","Layer","LayerShare","NewLayer","TileLayerEditor",function(e,t,r,n,i,a,o,s,l){t.getUrl=function(e){var t=window.location.protocol+"//"+window.location.host+"/layers/"+e._id;return t};t.canEdit=function(e){return a.canEdit(e)};t.canDelete=function(e){return a.canDelete(e)};t.isOwner=function(e){return a.isOwner(e)};t.isContributor=function(e){return a.isContributor(e)};t.edit=function(e){if(e.type=="TileLayer")t.editTileLayer(e);else n.path("/layers/"+e._id+"/edit/")};t.addContributor=function(r,n){a.resource.addContributor({layerId:n._id,email:r},function(r){n.contributors=r.layer.contributors;e.$broadcast("layer.contributor.added",n);t.newContributor=""})};t.removeContributor=function(t,r){a.resource.removeContributor({layerId:r._id,contributorId:t._id},function(e){console.log(e)});e.$broadcast("layer.contributor.removed",r)};t.new=function(){s.activate({newLayer:function(e,r){this.close();if(e=="TileLayer"){var i={type:"TileLayer",visibility:"Private",properties:{service:r}};t.editTileLayer(i)}else{n.path("/layers/new/")}},close:function(){s.deactivate()}});e.$on("$stateChangeStart",_.once(function(){s.deactivate()}))};t.editTileLayer=function(r){l.activate({saveTileLayer:function(r){if(!r._id){var n=new a.resource(r);n.$save(function(r){l.deactivate();t.editTileLayer(r.layer);e.$broadcast("layer.add.success",r.layer)})}else{t.save(r)}},close:function(){l.deactivate()},layer:r})};t.save=function(t){t.isDraft=false;a.resource.update({layerId:t._id},t,function(t){e.$broadcast("layer.save.success",t.layer)})};t.delete=function(t,r){if(confirm("Você tem certeza que deseja remover esta camada?")){a.resource.delete({layerId:t._id},function(r){e.$broadcast("layer.delete.success",t)})}};t.share=function(e){o.activate({layer:e,social:{facebook:"http://facebook.com/share.php?u="+t.getUrl(e),twitter:"http://twitter.com/share?url="+t.getUrl(e)},socialWindow:function(e,t){window.open(e,t,"width=550,height=300,resizable=1")},close:function(){o.deactivate()}});t.$on("$destroy",function(){o.deactivate()})};t.templates={list:"/views/layer/list-item.html"}}]},{}],30:[function(e,t,r){"use strict";e("../common/geocode");angular.module("mapasColetivos.layer",["ngResource","btford.modal","infinite-scroll","mapasColetivos.geocode","mapasColetivos.feature","mapasColetivos.content"]).config(["$stateProvider",function(e){e.state("dashboard.layers",{url:"layers/",templateUrl:"/views/dashboard/layers.html"}).state("layers",{url:"/layers/",controller:"LayerCtrl",templateUrl:"/views/layer/index.html"}).state("newLayer",{url:"/layers/new/",controller:"LayerCtrl",templateUrl:"/views/layer/index.html"}).state("singleLayer",{url:"/layers/:layerId/",controller:"LayerCtrl",templateUrl:"/views/layer/show.html"}).state("singleLayer.content",{url:"content/:contentId/"}).state("singleLayer.feature",{url:"feature/:featureId/"}).state("editLayer",{url:"/layers/:layerId/edit/",controller:"LayerCtrl",templateUrl:"/views/layer/edit.html"})}]).factory("Layer",e("./service.js").Layer).factory("LayerShare",e("./share").shareService).factory("NewLayer",e("./new").newLayerService).factory("TileLayerEditor",e("./tilelayer").tileLayerService).controller("LayerActionsCtrl",e("./actions").LayerActionsCtrl).controller("LayerCtrl",e("./controller").LayerCtrl)},{"../common/geocode":3,"./actions":29,"./controller":31,"./new":32,"./service.js":33,"./share":34,"./tilelayer":35}],31:[function(e,t,r){"use strict";r.LayerCtrl=["$scope","$rootScope","$location","$state","$stateParams","$q","Page","Layer","Feature","Maki","Content","MessageService","LoadingService","MapService","MapView",function(t,r,n,i,a,o,s,l,u,c,f,d,h,g,p){t.$layer=l;t.$feature=u;t.$content=f;var y;var m=function(t,n,i,a){if(!angular.equals(y,t)||i===true){y=angular.copy(t);g.clearFeatures();if(t){angular.forEach(t,function(t){var i=angular.copy(t);var a=angular.copy(n.styles[i.geometry.type]);_.extend(a,i.properties||{});i.properties=a;var o=e("../feature/featureToMapObjService")(i,null,g.get());if(o){o.on("click",function(){r.$broadcast("marker.clicked",i,n)});g.addFeature(o)}})}if(a!==false){window.dispatchEvent(new Event("resize"));setTimeout(function(){g.get().invalidateSize(false);window.dispatchEvent(new Event("resize"));g.fitFeatureLayer()},300)}}};if(n.path()=="/layers/new/"){d.disable();var v=new l.resource({title:"Untitled",type:"FeatureLayer"});v.$save(function(e){d.enable();n.path("/layers/"+e.layer._id+"/edit/").replace()})}else if(a.layerId){var w;t.$on("layer.delete.success",function(){n.path("/dashboard/layers").replace()});l.resource.get({layerId:a.layerId},function(e){if(!e.styles){e.styles={Point:{"marker-size":"medium","marker-color":"#7e7e7e","marker-symbol":""},Polygon:{stroke:"#555555","stroke-width":2,"stroke-opacity":1,fill:"#555555","fill-opacity":.5},LineString:{stroke:"#555555","stroke-width":2,"stroke-opacity":1}}}w=angular.copy(e);t.layer=angular.copy(e);t.$watch("layer.styles",function(){l.edit(t.layer)});t.baseUrl="/layers/"+e._id;s.setTitle(e.title);var a=g.init("layer-map",{center:[0,0],zoom:2});if(!e.description&&!e.features.length&&!e.contents.length){p.sidebar(false)}else{p.sidebar(true)}if(e.type=="TileLayer"){g.removeBaseLayer();var o=g.addTileLayer(e.url);if(e.properties.service=="mapbox"){o.on("load",_.once(function(){g.renderTileJSON(o.getTileJSON())}))}}else{if(!e.contributors)e.contributors=[];t.fitMarkerLayer=function(){g.fitFeatureLayer()};u.set(angular.copy(t.layer.features));m(t.layer.features,t.layer,true);setTimeout(function(){g.fitFeatureLayer()},200);var h=false;t.$on("content.filtering.started",function(t,r,n){h=true;if(n.length){m(n,e)}});t.$on("content.filtering.closed",function(){if(h){m(e.features,e);h=false}});f.set(e.contents);r.$broadcast("data.ready",e);g.get().invalidateSize(true)}if(n.path().indexOf("edit")!==-1){t.previewLayer=function(){m(t.layer.features,t.layer,true,false)};var y=r.$on("$stateChangeStart",function(e){var r=angular.copy(t.layer);var n=angular.copy(w);delete r.features;delete r.contents;delete n.features;delete n.contents;if(!angular.equals(r,n)){if(!confirm("Deseja sair sem salvar alterações?"))e.preventDefault();else l.deleteDraft(t.layer)}});t.$on("$destroy",function(){y()});setTimeout(function(){window.dispatchEvent(new Event("resize"))},100);if(!l.canEdit(e)){n.path("/layers/"+e._id);d.add({status:"error",text:"Sem permissões para editar esta camada"})}if(l.isOwner(e)){t.activeObj="settings"}else{t.activeObj="feature"}t.layerObj=function(e){if(t.activeObj==e)return"active";return false};t.setLayerObj=function(e){t.activeObj=e;setTimeout(function(){window.dispatchEvent(new Event("resize"))},100)};t.$watch("activeObj",function(e){u.edit(false);f.edit(false);t.$broadcast("layerObjectChange",e)});l.edit(e);t.$on("$destroy",function(){l.edit(false)});var v=t.$on("features.updated",function(){t.layer.features=u.get()});t.$on("$destroy",v);t.$watch("$feature.edit()",function(e){if(!e)m(t.layer.features,t.layer,true)});t.$watch("$content.get()",function(e){t.layer.contents=e});t.$watch("$feature.get()",function(e){t.layer.features=e});if(t.layer.title=="Untitled"){t.layer.title="";s.setTitle("Nova camada")}t.$on("layer.save.success",function(e,r){s.setTitle(r.title);w=angular.copy(r);t.layer=angular.copy(r);m(t.layer.features,t.layer,true,false)});t.close=function(){if(l.isDraft(t.layer)){n.path("/dashboard/layers").replace()}else{n.path("/layers/"+e._id)}};t.maki=c.maki;t.makiSprite=c.makiSprite}else{t.$on("marker.clicked",function(e,t){i.go("singleLayer.feature",{featureId:t._id})})}},function(){n.path("/layers").replace()});t.$on("$destroy",function(){g.destroy();t.features=[];t.contents=[];u.set([]);f.set([])})}else{s.setTitle("Camadas");l.resource.query(function(e){t.layers=e.layers;t.$watch("search",_.debounce(function(e){if(e){l.resource.query({search:e},function(e){t.layers=e.layers})}else{l.resource.query(function(e){t.layers=e.layers})}},300))})}t.$on("layer.page.next",function(e,r){if(r.layers.length){angular.forEach(r.layers,function(e){t.layers.push(e)});t.layers=t.layers}})}]},{"../feature/featureToMapObjService":21}],32:[function(e,t,r){"use strict";r.newLayerService=["btfModal",function(e){return e({controller:"LayerActionsCtrl",controllerAs:"layer",templateUrl:"/views/layer/new.html"})}]},{}],33:[function(e,t,r){"use strict";r.Layer=["$resource","$rootScope","apiPrefix","SessionService","LoadingService","MessageService",function(e,t,r,n,i,a){var o=false;var s={};return{resource:e(r+"/layers/:layerId",null,{query:{isArray:false,method:"GET",loadingMessage:"Carregando camadas",params:{perPage:10,page:1},interceptor:{response:function(e){s=e.config.params;return e.data}}},userLayers:{isArray:false,method:"GET",url:r+"/user/layers",loadingMessage:"Carregando camadas",params:{perPage:10,page:1},interceptor:{response:function(e){s=e.config.params;return e.data}}},update:{method:"PUT",loadingMessage:"Atualizando camada"},get:{method:"GET",loadingMessage:"Carregando camada"},"delete":{method:"DELETE",loadingMessage:"Removendo camada"},addContributor:{url:r+"/layers/:layerId/contributors/add",method:"PUT",loadingMessage:"Adicionando colaborador",params:{layerId:"@layerId",email:"@email"}},removeContributor:{url:r+"/layers/:layerId/contributors/remove",method:"DELETE",loadingMessage:"Removendo colaborador",params:{layerId:"@layerId",contributorId:"@contributorId"}}}),busy:false,nextPage:function(){var e=this;i.disable();if(!e.busy){e.busy=true;this.resource.query(_.extend(s,{page:s.page+1}),function(r){if(r.layers.length){e.busy=false;t.$broadcast("layer.page.next",r)}i.enable()})}},edit:function(e){if(typeof e!=="undefined")o=e;return o},isDraft:function(e){return e.isDraft},deleteDraft:function(e){a.disable();if(this.isDraft(e)){this.resource.delete({layerId:e._id},function(){a.enable()})}},isOwner:function(e){if(!e||!n.user())return false;if(typeof e.creator=="string"&&e.creator==n.user()._id){return true}else if(typeof e.creator=="object"&&e.creator._id==n.user()._id){return true}return false},isContributor:function(e){if(!e||!n.user())return false;var t=false;if(e.contributors&&e.contributors.length){angular.forEach(e.contributors,function(e){if(typeof e=="string"&&e==n.user()._id)t=true;else if(typeof e=="object"&&e._id==n.user()._id)t=true})}return t},canEdit:function(e){if(this.isOwner(e)||this.isContributor(e))return true;return false},canDelete:function(e){if(this.isOwner(e))return true;return false}}}]},{}],34:[function(e,t,r){"use strict";r.shareService=["btfModal",function(e){return e({controller:"LayerActionsCtrl",controllerAs:"share",templateUrl:"/views/layer/share.html"})}]},{}],35:[function(e,t,r){"use strict";r.tileLayerService=["btfModal",function(e){return e({controller:"LayerActionsCtrl",controllerAs:"actions",templateUrl:"/views/layer/tilelayer.html"})}]},{}],36:[function(e,t,r){"use strict";r.MapActionsCtrl=["$rootScope","$scope","$q","$location","MessageService","SessionService","Map","MapShare",function(e,t,r,n,i,a,o,s){t.$session=a;t.$watch("$session.user()",function(e){t.user=e});t.getUrl=function(e){var t=window.location.protocol+"//"+window.location.host+"/maps/"+e._id;return t};t.canEdit=function(e){if(!e||!t.user)return false;if(typeof e.creator=="string"&&e.creator==t.user._id){return true}else if(typeof e.creator=="object"&&e.creator._id==t.user._id){return true}return false};t.edit=function(e){n.path("/maps/"+e._id+"/edit")};t.save=function(t){if(t.bounds){t.southWest=t.bounds[0];t.northEast=t.bounds[1]}t.isDraft=false;var n=r.defer();o.resource.update({mapId:t._id},t,function(t){if(t.southWest&&t.northEast){t.bounds=[t.southWest,t.northEast]}i.message({status:"ok",text:"Mapa atualizado"});e.$broadcast("map.save.success",t);n.resolve(t)},function(t){i.message({status:"error",text:"Ocorreu um erro."});e.$broadcast("map.save.error",t);n.resolve(t)});return n.promise};t.delete=function(t,r){if(confirm("Você tem certeza que deseja remover este mapa?")){o.resource.delete({mapId:t._id},function(r){e.$broadcast("map.delete.success",t)})}};t.share=function(e){s.activate({map:e,social:{facebook:"http://facebook.com/share.php?u="+t.getUrl(e),twitter:"http://twitter.com/share?url="+t.getUrl(e)},socialWindow:function(e,t){window.open(e,t,"width=550,height=300,resizable=1")},close:function(){s.deactivate()}});t.$on("$destroy",function(){s.deactivate()})};t.templates={list:"/views/map/list-item.html"}}]},{}],37:[function(e,t,r){"use strict";angular.module("mapasColetivos.map",["btford.modal","ui.sortable","mapasColetivos.leaflet","mapasColetivos.layer"]).config(["$stateProvider",function(e){e.state("dashboard.maps",{url:"maps/",templateUrl:"/views/dashboard/maps.html"}).state("maps",{url:"/maps/",controller:"MapCtrl",templateUrl:"/views/map/index.html"}).state("newMap",{url:"/maps/new/",controller:"MapCtrl",templateUrl:"/views/map/index.html"}).state("singleMap",{url:"/maps/:mapId/",controller:"MapCtrl",templateUrl:"/views/map/show.html"}).state("singleMap.content",{url:"content/:contentId/"}).state("singleMap.feature",{url:"feature/:featureId/"}).state("editMap",{url:"/maps/:mapId/edit/",controller:"MapCtrl",templateUrl:"/views/map/edit.html"})}]).factory("Map",e("./service").Map).factory("MapShare",e("./share").shareService).controller("MapCtrl",e("./controller").MapCtrl).controller("MapActionsCtrl",e("./actions").MapActionsCtrl)},{"./actions":36,"./controller":38,"./service":39,"./share":40}],38:[function(e,t,r){"use strict";r.MapCtrl=["$scope","$rootScope","$timeout","$location","$state","$stateParams","Page","Map","Layer","Content","Feature","MapService","MapView","MessageService","SessionService",function(e,t,r,n,i,a,o,s,l,u,c,f,d,h,g){e.$session=g;e.$watch("$session.user()",function(t){e.user=t});e.$map=s;if(n.path()=="/maps/new/"){var p=new s.resource({title:"Untitled",center:[0,0],zoom:2});p.$save(function(e){n.path("/maps/"+e._id+"/edit/").replace()},function(e){})}else if(a.mapId){var y;e.activeObj="settings";e.mapObj=function(t){if(e.activeObj==t)return"active";return false};e.setMapObj=function(t){e.activeObj=t;setTimeout(function(){window.dispatchEvent(new Event("resize"))},100)};e.isEditing=function(){return n.path().indexOf("edit")!==-1};s.resource.get({mapId:a.mapId},function(a){d.sidebar(true);o.setTitle(a.title);y=a;e.map=angular.copy(a);e.baseUrl="/maps/"+a._id;var h={center:e.map.center?e.map.center:[0,0],zoom:e.map.zoom?e.map.zoom:2};if(!e.isEditing()){h=_.extend(h,{minZoom:e.map.minZoom?e.map.minZoom:undefined,maxZoom:e.map.maxZoom?e.map.maxZoom:undefined,maxBounds:e.map.southWest.length?L.latLngBounds(e.map.southWest,e.map.northEast):undefined})}var a=f.init("map",h);if(e.isEditing()){var g=t.$on("$stateChangeStart",function(t){if(!angular.equals(e.map,y))if(!confirm("Deseja sair sem salvar alterações?"))t.preventDefault();else s.deleteDraft(e.map)});e.$on("$destroy",function(){g()});l.resource.query({creatorOnly:true},function(t){e.userLayers=t.layers;e.availableLayers=angular.copy(e.userLayers)})}e.layerSearch="";e.$watch("layerSearch",_.debounce(function(t){if(t){l.resource.query({search:t},function(t){if(t.layers){e.availableLayers=t.layers}})}else{r(function(){e.availableLayers=angular.copy(e.userLayers)},100)}},300));e.toggleLayer=function(t){if(!e.map.layers)e.map.layers=[];var r=angular.copy(e.map.layers);if(e.hasLayer(t)){if(e.isEditing()&&confirm("Tem certeza que gostaria de remover esta camada do seu mapa?"))r=r.filter(function(e){return e!==t._id})}else{r.push(t._id)}e.map.layers=r};e.hasLayer=function(t){if(!e.map.layers)e.map.layers=[];return e.map.layers.filter(function(e){return e==t._id}).length};e.$watch("map.layers",function(t){m=[];f.clearAll();e.layers=[];e.contents=[];angular.forEach(t,function(e){var t,r;if(p[e]){t=p[e];v(t)}else{l.resource.get({layerId:e},function(e){e=p[e._id]=e;v(e)})}})});var p={};var m=[];var v=function(t){var r=f.addLayer(t);if(t.type=="FeatureLayer"){t._mcData=r;angular.forEach(r.features,function(t){m.push(t);t.on("click",function(){if(!e.isEditing()){i.go("singleMap.feature",{featureId:t.mcFeature._id})}else{}})})}e.layers.push(t);if(e.layers.length===e.map.layers.length){e.fixLayerOrdering();e.setupMapContent()}};e.fixLayerOrdering=function(){var t=[];angular.forEach(e.map.layers,function(r){t.push(e.layers.filter(function(e){return e._id==r})[0])});e.layers=t};e.setupMapContent=function(){var r=[];var n=[];angular.forEach(e.layers,function(e){angular.forEach(e.features,function(t){t.layer=e;n.push(t)});angular.forEach(e.contents,function(t){t.layer=e;r.push(t)})});u.set(r);c.set(n);t.$broadcast("data.ready",e.map);e.$on("features.updated",function(e,t){w(t)})};var w=function(t){var r=L.featureGroup();var n=f.get();angular.forEach(e.layers,function(e){if(e.type=="FeatureLayer"){var n=e._mcData.featureLayer;var i=e._mcData.features;angular.forEach(i,function(e){if(!t.filter(function(t){return e.mcFeature._id==t._id}).length)n.removeLayer(e);else{if(!n.hasLayer(e))n.addLayer(e);r.addLayer(e)}})}});if(n&&t.length!==m.length){}else{n.setView(e.map.center,e.map.zoom)}};e.hideAllLayers=function(){angular.forEach(e.layers,function(t){e.hideLayer(t._mcData.markerLayer)})};e.hideLayer=function(e){f.get().removeLayer(e)};e.showAllLayers=function(){angular.forEach(e.layers,function(t){e.showLayer(t._mcData.markerLayer)})};e.showLayer=function(e){f.get().addLayer(e)};e.sortLayer={stop:function(){var t=[];angular.forEach(e.layers,function(e){t.push(e._id)});e.map.layers=t}};e.autoInput={center:function(){var t=f.get().getCenter();e.map.center=[t.lat,t.lng]},zoom:function(){e.map.zoom=f.get().getZoom()},bounds:function(){var t=f.get().getBounds();e.map.bounds=[[t.getSouth(),t.getWest()],[t.getNorth(),t.getEast()]]},minZoom:function(){e.map.minZoom=f.get().getZoom()},maxZoom:function(){e.map.maxZoom=f.get().getZoom()},all:function(){this.center();this.zoom();this.bounds();this.minZoom();this.maxZoom()}};e.$on("map.save.success",function(t,r){o.setTitle(r.title);y=r;e.map=angular.copy(r)});e.$on("map.delete.success",function(){n.path("/dashboard/maps").replace()});e.close=function(){if(s.isDraft(e.map)){n.path("/dashboard/maps")}else{n.path("/maps/"+e.map._id)}};if(n.path().indexOf("edit")!==-1){if(e.map.title=="Untitled"){e.map.title="";o.setTitle("Novo mapa")}}})}else{o.setTitle("Mapas");s.resource.query(function(t){e.maps=t.maps;e.$watch("search",_.debounce(function(t){if(t){s.resource.query({search:t},function(t){e.maps=t.maps})}else{s.resource.query(function(t){e.maps=t.maps})}},300))})}e.$on("map.page.next",function(t,r){if(r.maps.length){angular.forEach(r.maps,function(t){e.maps.push(t)});e.maps=e.maps}})}]},{}],39:[function(e,t,r){"use strict";r.Map=["$resource","$rootScope","apiPrefix","LoadingService","MessageService",function(e,t,r,n,i){var a={};return{resource:e(r+"/maps/:mapId",null,{query:{isArray:false,method:"GET",loadingMessage:"Carregando mapas",params:{perPage:10,page:1},interceptor:{response:function(e){a=e.config.params;return e.data}}},userMaps:{isArray:false,method:"GET",url:r+"/user/maps",loadingMessage:"Carregando mapas",params:{perPage:10,page:1},interceptor:{response:function(e){a=e.config.params;return e.data}}},get:{method:"GET",loadingMessage:"Carregando mapa",interceptor:{response:function(e){var t=e.data;if(t.southWest&&t.northEast){t.bounds=[t.southWest,t.northEast]}return t}}},update:{method:"PUT",loadingMessage:"Atualizando mapa"},"delete":{method:"DELETE",loadingMessage:"Removendo mapa"}}),busy:false,nextPage:function(){var e=this;n.disable();if(!e.busy){e.busy=true;this.resource.query(_.extend(a,{page:a.page+1}),function(r){if(r.maps.length){e.busy=false;t.$broadcast("map.page.next",r)}n.enable()})}},isDraft:function(e){return e.isDraft},deleteDraft:function(e){i.disable();if(this.isDraft(e)){this.resource.delete({mapId:e._id},function(){i.enable()})}}}}]},{}],40:[function(e,t,r){"use strict";r.shareService=["btfModal",function(e){return e({controller:"MapActionsCtrl",controllerAs:"share",templateUrl:"/views/map/share.html"})}]},{}],41:[function(e,t,r){"use strict";angular.module("mapasColetivos.session",[]).config(["$stateProvider",function(e){e.state("login",{url:"/login/",controller:"LoginCtrl",templateUrl:"/views/login.html"})}]).factory("SessionService",e("./sessionService")).controller("LoginCtrl",e("./loginCtrl")).factory("authInterceptor",["$rootScope","$q","$window",function(e,t,r){return{request:function(e){e.params=e.params||{};if(r.sessionStorage.accessToken){e.params.access_token=r.sessionStorage.accessToken}return e},responseError:function(e){if(e.status===401){}return t.reject(e)}}}]).config(["$httpProvider",function(e){e.interceptors.push("authInterceptor")}])},{"./loginCtrl":42,"./sessionService":43}],42:[function(e,t,r){"use strict";t.exports=["$scope","SessionService","$location","config","$sce",function(e,t,r,n,i){e.authFacebook=i.trustAsResourceUrl(n.server+"/auth/facebook");e.authGoogle=i.trustAsResourceUrl(n.server+"/auth/google");e.local=window.location.href;e.$session=t;e.$watch("$session.authenticated()",function(t){e.isAuthenticated=t});e.login=function(n){if(n=="facebook"){}else if(n=="google"){}else{t.authenticate(e.credentials,function(e){r.path("/dashboard")})}};e.logout=t.logout}]},{}],43:[function(e,t,r){"use strict";t.exports=["$window","$q","$http","$rootScope","$location","apiPrefix","config",function(e,t,r,n,i,a,o){return{authenticate:function(t,i){r.post(a+"/users/session",t).success(function(t,r,a,o){console.log(t);for(var s in t){e.sessionStorage[s]=t[s]}n.$broadcast("session.logged.in");if(typeof i==="function")i(t)})},logout:function(){for(var t in e.sessionStorage){delete e.sessionStorage[t]}i.path("/login/")},authenticated:function(){return!!e.sessionStorage.accessToken},user:function(){return e.sessionStorage}}}]},{}],44:[function(e,t,r){"use strict";angular.module("mapasColetivos.user",["btford.modal"]).config(["$stateProvider",function(e){e.state("user",{url:"/user/:userId/",controller:"UserCtrl",templateUrl:"/views/user/show.html"}).state("user.layers",{url:"layers/",templateUrl:"/views/user/layers.html"}).state("user.maps",{url:"maps/",templateUrl:"/views/user/maps.html"})}]).factory("User",e("./service").User).factory("ChangePwd",e("./changePwd").changePwd).factory("ChangeEmail",e("./changeEmail").changeEmail).controller("UserCtrl",e("./controller").UserCtrl)},{"./changeEmail":45,"./changePwd":46,"./controller":47,"./service":48}],45:[function(e,t,r){"use strict";r.changeEmail=["btfModal",function(e){return e({controller:"UserCtrl",controllerAs:"share",templateUrl:"/views/user/change-email.html"})}]},{}],46:[function(e,t,r){"use strict";r.changePwd=["btfModal",function(e){return e({controller:"UserCtrl",controllerAs:"share",templateUrl:"/views/user/change-password.html"})}]},{}],47:[function(e,t,r){"use strict";r.UserCtrl=["$scope","$rootScope","$state","$stateParams","User","ChangePwd","ChangeEmail","Layer","Map","Page","MessageService",function(e,t,r,n,i,a,o,s,l,u,c){e.save=function(e){i.resource.update({userId:e._id},e,function(r){t.$broadcast("user.save.success",e)},function(e){t.$broadcast("user.save.error",e)})};e.openPwdModal=function(t){a.activate({user:t});e.$on("$destroy",function(){a.deactivate()})};e.closePwdModal=function(){a.deactivate()};e.openEmailModal=function(t){o.activate({user:t});e.$on("$destroy",function(){o.deactivate()})};e.closeEmailModal=function(){o.deactivate()};e.changePassword=function(e,t){if(typeof t==="undefined"){return false}if(!t.userPwd){c.message({status:"error",text:"Você deve inserir sua senha atual."});return false}if(!t.newPwd){c.message({status:"error",text:"Você deve inserir uma nova senha."});return false}if(t.newPwd!=t.validatePwd){c.message({status:"error",text:"As senhas não são compatíveis"});return false}i.resource.update({userId:e._id},t)};e.changeEmail=function(e){if(!e.newEmail){c.message({status:"error",text:"Você deve inserir um email."});return false}i.resource.update({userId:e._id},{email:e.newEmail})};e.profileUrl=function(e){if(typeof e!=="undefined"){var t=e._id;if(e.username)t=e.username;return"/user/"+t+"/"}return""};if(n.userId){i.resource.get({userId:n.userId},function(t){u.setTitle(t.name);e.user=t},function(e){c.message({status:"error",text:"Ocorreu um erro."})});e.$layer=s;s.resource.query({userId:n.userId},function(t){e.totalLayer=t.layersTotal;e.layers=t.layers});e.$on("layer.page.next",function(t,r){if(r.layers.length){angular.forEach(r.layers,function(t){e.layers.push(t)});e.layers=e.layers}});e.$map=l;l.resource.query({userId:n.userId},function(t){e.totalMap=t.mapsTotal;e.maps=t.maps});e.$on("map.page.next",function(t,r){if(r.maps.length){angular.forEach(r.maps,function(t){e.maps.push(t)});e.maps=e.maps}});var f=function(){e.currentState=r.current.name.replace("user.","")};t.$on("$viewContentLoaded",function(){f()});t.$on("$stateChangeSuccess",function(){f()})}}]},{}],48:[function(e,t,r){"use strict";r.User=["$resource","apiPrefix",function(e,t){var r=function(e,t){if(typeof t==="undefined")t=100;return grvtr.create(e,{size:t,defaultImage:"mm",rating:"g"})};return{resource:e(t+"/users/:userId",{},{get:{method:"GET",loadingMessage:"Carregando usuário",interceptor:{response:function(e){var t=e.data;t.gravatar=function(e){return r(t.email,e)};return t}}},update:{method:"PUT",loadingMessage:"Atualizando usuário",url:t+"/users"},updatePwd:{method:"PUT",loadingMessage:"Alterando senha"}}),gravatar:r}}]},{}],49:[function(e,t,r){},{}],50:[function(e,t,r){t.exports=e(49)},{}],51:[function(e,t,r){var n=t.exports={};n.nextTick=function(){var e=typeof window!=="undefined"&&window.setImmediate;var t=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(e){return function(e){return window.setImmediate(e)}}if(t){var r=[];window.addEventListener("message",function(e){var t=e.source;if((t===window||t===null)&&e.data==="process-tick"){e.stopPropagation();if(r.length>0){var n=r.shift();n()}}},true);return function n(e){r.push(e);window.postMessage("process-tick","*")}}return function i(e){setTimeout(e,0)}}();n.title="browser";n.browser=true;n.env={};n.argv=[];n.binding=function(e){throw new Error("process.binding is not supported")};n.cwd=function(){return"/"};n.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],52:[function(e,t,r){var n=e("dsv"),i=e("sexagesimal");function a(e){return!!e.match(/(Lat)(itude)?/gi)}function o(e){return!!e.match(/(L)(on|ng)(gitude)?/i)}function s(e){return typeof e=="object"?Object.keys(e).length:0}function l(e){var t=[",",";","	","|"];var r=[];t.forEach(function(t){var i=n(t).parse(e);if(i.length>=1){var a=s(i[0]);for(var o=0;o<i.length;o++){if(s(i[o])!==a)return}r.push({delimiter:t,arity:Object.keys(i[0]).length})}});if(r.length){return r.sort(function(e,t){return t.arity-e.arity})[0].delimiter}else{return null}}function u(e){var t=l(e);if(!t)return null;return n(t).parse(e)}function c(e,t,r){if(!r){r=t;t={}}t.delimiter=t.delimiter||",";var s=t.latfield||"",u=t.lonfield||"";var c=[],f={type:"FeatureCollection",features:c};if(t.delimiter==="auto"&&typeof e=="string"){t.delimiter=l(e);if(!t.delimiter)return r({type:"Error",message:"Could not autodetect delimiter"})}var d=typeof e=="string"?n(t.delimiter).parse(e):e;if(!d.length)return r(null,f);if(!s||!u){for(var h in d[0]){if(!s&&a(h))s=h;if(!u&&o(h))u=h}if(!s||!u){var g=[];for(var p in d[0])g.push(p);return r({type:"Error",message:"Latitude and longitude fields not present",data:d,fields:g})
}}var y=[];for(var m=0;m<d.length;m++){if(d[m][u]!==undefined&&d[m][u]!==undefined){var v=d[m][u],w=d[m][s],b,x,k;k=i(v,"EW");if(k)v=k;k=i(w,"NS");if(k)w=k;b=parseFloat(v);x=parseFloat(w);if(isNaN(b)||isNaN(x)){y.push({message:"A row contained an invalid value for latitude or longitude",row:d[m]})}else{if(!t.includeLatLon){delete d[m][u];delete d[m][s]}c.push({type:"Feature",properties:d[m],geometry:{type:"Point",coordinates:[parseFloat(b),parseFloat(x)]}})}}}r(y.length?y:null,f)}function f(e){var t=e.features;var r={type:"Feature",geometry:{type:"LineString",coordinates:[]}};for(var n=0;n<t.length;n++){r.geometry.coordinates.push(t[n].geometry.coordinates)}r.properties=t[0].properties;return{type:"FeatureCollection",features:[r]}}function d(e){var t=e.features;var r={type:"Feature",geometry:{type:"Polygon",coordinates:[[]]}};for(var n=0;n<t.length;n++){r.geometry.coordinates[0].push(t[n].geometry.coordinates)}r.properties=t[0].properties;return{type:"FeatureCollection",features:[r]}}t.exports={isLon:o,isLat:a,csv:n.csv.parse,tsv:n.tsv.parse,dsv:n,auto:u,csv2geojson:c,toLine:f,toPolygon:d}},{dsv:53,sexagesimal:54}],53:[function(e,t,r){var n=e("fs");t.exports=new Function('dsv.version = "0.0.3";\n\ndsv.tsv = dsv("\\t");\ndsv.csv = dsv(",");\n\nfunction dsv(delimiter) {\n  var dsv = {},\n      reFormat = new RegExp("[\\"" + delimiter + "\\n]"),\n      delimiterCode = delimiter.charCodeAt(0);\n\n  dsv.parse = function(text, f) {\n    var o;\n    return dsv.parseRows(text, function(row, i) {\n      if (o) return o(row, i - 1);\n      var a = new Function("d", "return {" + row.map(function(name, i) {\n        return JSON.stringify(name) + ": d[" + i + "]";\n      }).join(",") + "}");\n      o = f ? function(row, i) { return f(a(row), i); } : a;\n    });\n  };\n\n  dsv.parseRows = function(text, f) {\n    var EOL = {}, // sentinel value for end-of-line\n        EOF = {}, // sentinel value for end-of-file\n        rows = [], // output rows\n        N = text.length,\n        I = 0, // current character index\n        n = 0, // the current line number\n        t, // the current token\n        eol; // is the current token followed by EOL?\n\n    function token() {\n      if (I >= N) return EOF; // special case: end of file\n      if (eol) return eol = false, EOL; // special case: end of line\n\n      // special case: quotes\n      var j = I;\n      if (text.charCodeAt(j) === 34) {\n        var i = j;\n        while (i++ < N) {\n          if (text.charCodeAt(i) === 34) {\n            if (text.charCodeAt(i + 1) !== 34) break;\n            ++i;\n          }\n        }\n        I = i + 2;\n        var c = text.charCodeAt(i + 1);\n        if (c === 13) {\n          eol = true;\n          if (text.charCodeAt(i + 2) === 10) ++I;\n        } else if (c === 10) {\n          eol = true;\n        }\n        return text.substring(j + 1, i).replace(/""/g, "\\"");\n      }\n\n      // common case: find next delimiter or newline\n      while (I < N) {\n        var c = text.charCodeAt(I++), k = 1;\n        if (c === 10) eol = true; // \\n\n        else if (c === 13) { eol = true; if (text.charCodeAt(I) === 10) ++I, ++k; } // \\r|\\r\\n\n        else if (c !== delimiterCode) continue;\n        return text.substring(j, I - k);\n      }\n\n      // special case: last token before EOF\n      return text.substring(j);\n    }\n\n    while ((t = token()) !== EOF) {\n      var a = [];\n      while (t !== EOL && t !== EOF) {\n        a.push(t);\n        t = token();\n      }\n      if (f && !(a = f(a, n++))) continue;\n      rows.push(a);\n    }\n\n    return rows;\n  };\n\n  dsv.format = function(rows) {\n    if (Array.isArray(rows[0])) return dsv.formatRows(rows); // deprecated; use formatRows\n    var fieldSet = {}, fields = [];\n\n    // Compute unique fields in order of discovery.\n    rows.forEach(function(row) {\n      for (var field in row) {\n        if (!(field in fieldSet)) {\n          fields.push(fieldSet[field] = field);\n        }\n      }\n    });\n\n    return [fields.map(formatValue).join(delimiter)].concat(rows.map(function(row) {\n      return fields.map(function(field) {\n        return formatValue(row[field]);\n      }).join(delimiter);\n    })).join("\\n");\n  };\n\n  dsv.formatRows = function(rows) {\n    return rows.map(formatRow).join("\\n");\n  };\n\n  function formatRow(row) {\n    return row.map(formatValue).join(delimiter);\n  }\n\n  function formatValue(text) {\n    return reFormat.test(text) ? "\\"" + text.replace(/\\"/g, "\\"\\"") + "\\"" : text;\n  }\n\n  return dsv;\n}\n'+";return dsv")()},{fs:49}],54:[function(e,t,r){t.exports=function(e,t){if(!t)t="NSEW";if(typeof e!=="string")return null;var r=/^([0-9.]+)°? *(?:([0-9.]+)['’′‘] *)?(?:([0-9.]+)(?:''|"|”|″) *)?([NSEW])?/,n=e.match(r);if(!n)return null;else if(n[4]&&t.indexOf(n[4])===-1)return null;else return((n[1]?parseFloat(n[1]):0)+(n[2]?parseFloat(n[2])/60:0)+(n[3]?parseFloat(n[3])/3600:0))*(n[4]&&n[4]==="S"||n[4]==="W"?-1:1)}},{}],55:[function(e,t,r){t.exports=[{name:"Circle stroked",tags:["circle","disc","shape","shapes","geometric","stroke","round"],icon:"circle-stroked"},{name:"Circle solid",tags:["circle","shape","shapes","geometric","round"],icon:"circle"},{name:"Square stroked",tags:["box","square","shapes","shape","geometric","stroke"],icon:"square-stroked"},{name:"Square solid",tags:["box","square","shape","shapes","geometric"],icon:"square"},{name:"Triangle stroked",tags:["triangle","shape","shapes","geometric","stroke"],icon:"triangle-stroked"},{name:"Triangle solid",tags:["triangle","shape","shapes","geometric"],icon:"triangle"},{name:"Star stroked",tags:["star","shape","shapes","geometric","stroke"],icon:"star-stroked"},{name:"Star solid",tags:["star","shape","shapes","geometric"],icon:"star"},{name:"Cross",tags:["cross","x","ex","shape","shapes","geometric"],icon:"cross"},{name:"Marker Stroke",tags:["marker","point","shape","shapes","stroke"],icon:"marker-stroked"},{name:"Marker Solid",tags:["marker","point","shape","shapes"],icon:"marker"},{name:"Religious Jewish",tags:["jewish","judaism","hebrew","star","david","religious","religion","temple","synagogue"],icon:"religious-jewish"},{name:"Religious Christian",tags:["christian","cross","religious","religion","church","cathedral"],icon:"religious-christian"},{name:"Religious Muslim",tags:["muslim","crescent","star","religious","religion","mosque"],icon:"religious-muslim"},{name:"Cemetery",tags:["cemetery","graveyard","funeral","religious","religion","memorial"],icon:"cemetery"},{name:"Rocket",tags:["rocket","space","launch","transportation"],icon:"rocket"},{name:"Airport",tags:["airplane","plane","airport","transportation"],icon:"airport"},{name:"Heliport",tags:["heliport","helicopter","transportation"],icon:"heliport"},{name:"Rail",tags:["rail","train","transportation"],icon:"rail"},{name:"Rail Metro",tags:["rail","train","metro","subway","rapid-transit","transportation"],icon:"rail-metro"},{name:"Rail Light",tags:["rail","train","light-rail","transportation"],icon:"rail-light"},{name:"Bus",tags:["vehicle","bus","transportation"],icon:"bus"},{name:"Fuel",tags:["petrol","fuel","gas","transportation","station"],icon:"fuel"},{name:"Parking",tags:["parking","transportation"],icon:"parking"},{name:"Parking Garage",tags:["parking","transportation","garage"],icon:"parking-garage"},{name:"Airfield",tags:["airfield","airport","plane","landing strip"],icon:"airfield"},{name:"Roadblock",tags:["roadblock","stop","warning","dead end"],icon:"roadblock"},{name:"Ferry",tags:["ship","boat","water","ferry","transportation"],icon:"ferry"},{name:"Harbor",tags:["marine","dock","water","wharf"],icon:"harbor"},{name:"Bicycle",tags:["cycling","cycle","transportation"],icon:"bicycle"},{name:"Park",tags:["recreation","park","forest","tree","green","woods","nature"],icon:"park"},{name:"Park 2",tags:["recreation","park","forest","tree","green","woods","nature"],icon:"park2"},{name:"Museum",tags:["recreation","museum","tourism"],icon:"museum"},{name:"Lodging",tags:["lodging","hotel","recreation","motel","tourism"],icon:"lodging"},{name:"Monument",tags:["recreation","statue","monument","tourism"],icon:"monument"},{name:"Zoo",tags:["recreation","zoo","animal","giraffe"],icon:"zoo"},{name:"Garden",tags:["recreation","garden","park","flower","nature"],icon:"garden"},{name:"Campsite",tags:["recreation","campsite","camp","camping","tent","nature"],icon:"campsite"},{name:"Theatre",tags:["recreation","theatre","theater","entertainment","play","performance"],icon:"theatre"},{name:"Art gallery",tags:["art","center","museum","gallery","creative","recreation","entertainment","studio"],icon:"art-gallery"},{name:"Pitch",tags:["pitch","track","athletic","sports","field"],icon:"pitch"},{name:"Soccer",tags:["soccer","sports"],icon:"soccer"},{name:"American Football",tags:["football","sports"],icon:"america-football"},{name:"Tennis",tags:["tennis","court","ball","sports"],icon:"tennis"},{name:"Basketball",tags:["basketball","ball","sports"],icon:"basketball"},{name:"Baseball",tags:["baseball","softball","ball","sports"],icon:"baseball"},{name:"Golf",tags:["golf","sports","course"],icon:"golf"},{name:"Swimming",tags:["swimming","water","swim","sports"],icon:"swimming"},{name:"Cricket",tags:["cricket","sports"],icon:"cricket"},{name:"Skiing",tags:["winter","skiing","ski","sports"],icon:"skiing"},{name:"School",tags:["school","highschool","elementary","children","amenity","middle"],icon:"school"},{name:"College",tags:["college","school","amenity","university"],icon:"college"},{name:"Library",tags:["library","books","amenity"],icon:"library"},{name:"Post",tags:["post","office","amenity","mail","letter"],icon:"post"},{name:"Fire station",tags:["fire","station","amenity"],icon:"fire-station"},{name:"Town hall",tags:["townhall","mayor","building","amenity","government"],icon:"town-hall"},{name:"Police",tags:["police","jail","arrest","amenity","station"],icon:"police"},{name:"Prison",tags:["prison","jail","amenity"],icon:"prison"},{name:"Embassy",tags:["embassy","diplomacy","consulate","amenity","flag"],icon:"embassy"},{name:"Beer",tags:["bar","beer","drink","commercial","biergarten","pub"],icon:"beer"},{name:"Restaurant",tags:["restaurant","commercial"],icon:"restaurant"},{name:"Cafe",tags:["cafe","coffee","commercial","tea"],icon:"cafe"},{name:"Shop",tags:["shop","mall","commercial","store"],icon:"shop"},{name:"Fast Food",tags:["food","fast","commercial","burger","drive-through"],icon:"fast-food"},{name:"Bar",tags:["bar","drink","commercial","club","martini","lounge"],icon:"bar"},{name:"Bank",tags:["bank","atm","commercial","money"],icon:"bank"},{name:"Grocery",tags:["food","grocery","commercial","store","market"],icon:"grocery"},{name:"Cinema",tags:["cinema","theatre","film","movie","commercial","theater","entertainment"],icon:"cinema"},{name:"Pharmacy",tags:["pharmacy","drugs","medication","social","medicine","prescription"],icon:"pharmacy"},{name:"Hospital",tags:["hospital","health","medication","social","medicine","medical","clinic"],icon:"hospital"},{name:"Danger",tags:["minefield","landmine","disaster","dangerous","hazard"],icon:"danger"},{name:"Industrial",tags:["industrial","factory","property","building"],icon:"industrial"},{name:"Warehouse",tags:["warehouse","property","storage","building"],icon:"warehouse"},{name:"Commercial",tags:["commercial","property","business","building"],icon:"commercial"},{name:"Building",tags:["building","property","structure","business","building"],icon:"building"},{name:"Place of worship",tags:["religion","ceremony","religious","nondenominational","church","temple"],icon:"place-of-worship"},{name:"Alcohol shop",tags:["alcohol","liquor","store","shop","beer","wine","vodka"],icon:"alcohol-shop"},{name:"Logging",tags:["logger","chainsaw","woods","industry"],icon:"logging"},{name:"Oil well",tags:["oil","natural","environment","industry","resources"],icon:"oil-well"},{name:"Slaughterhouse",tags:["cows","cattle","food","meat","industry","resources"],icon:"slaughterhouse"},{name:"Dam",tags:["water","natural","hydro","hydroelectric","energy","environment","industry","resources"],icon:"dam"},{name:"Water",tags:["water","natural","hydro","lake","river","ocean","resources"],icon:"water"},{name:"Wetland",tags:["water","swamp","natural"],icon:"wetland"},{name:"Disability",tags:["handicap","wheelchair","access"],icon:"disability"},{name:"Telephone",tags:["payphone","call"],icon:"telephone"},{name:"Emergency Telephone",tags:["payphone","danger","safety","call"],icon:"emergency-telephone"},{name:"Toilets",tags:["bathroom","men","women","sink","washroom","lavatory"],icon:"toilets"},{name:"Waste Basket",tags:["trash","rubbish","bin","garbage"],icon:"waste-basket"},{name:"Music",tags:["stage","performance","band","concert","venue"],icon:"music"},{name:"Land Use",tags:["zoning","usage","area"],icon:"land-use"},{name:"City",tags:["area","point","place","urban"],icon:"city"},{name:"Town",tags:["area","point","place","small"],icon:"town"},{name:"Village",tags:["area","point","place","small","rural"],icon:"village"},{name:"Farm",tags:["building","farming","crops","plants","agriculture","rural"],icon:"farm"},{name:"Bakery",tags:["bakery","pastry","croissant","food","shop","bread"],icon:"bakery"},{name:"Dog Park",tags:["dog","pet"],icon:"dog-park"},{name:"Lighthouse",tags:["building","navigation","nautical","ocean","logistics"],icon:"lighthouse"},{name:"Clothing Store",tags:["clothing","store","shop"],icon:"clothing-store"},{name:"Polling Place",tags:["poll","polling","vote"],icon:"polling-place"},{name:"Playground",tags:["playground","play","park","children"],icon:"playground"},{name:"Entrance",tags:["entrance","enter","subway","rail"],icon:"entrance"},{name:"Heart",tags:["heart","love","shape","shapes","wedding"],icon:"heart"},{name:"London Underground",tags:["deprecated"],icon:"london-underground"},{name:"Minefield",tags:["deprecated"],icon:"minefield"},{name:"Rail Underground",tags:["deprecated"],icon:"rail-underground"},{name:"Rail Above",tags:["deprecated"],icon:"rail-above"},{name:"Camera",tags:["camera","photo","commercial","shop"],icon:"camera"},{name:"Laundry",tags:["laundry","washing machine","dry_cleaning","commercial","store"],icon:"laundry"},{name:"Car",tags:["car","auto","vehicle","transportation"],icon:"car"},{name:"Suitcase",tags:["suitcase","travel","travel agency","commercial","store"],icon:"suitcase"}]},{}],56:[function(e,t,r){t.exports={"circle-stroked-24":{x:0,y:0,width:24,height:24},"circle-stroked-18":{x:24,y:0,width:18,height:18},"circle-stroked-12":{x:42,y:0,width:12,height:12},"circle-24":{x:54,y:0,width:24,height:24},"circle-18":{x:78,y:0,width:18,height:18},"circle-12":{x:96,y:0,width:12,height:12},"square-stroked-24":{x:108,y:0,width:24,height:24},"square-stroked-18":{x:132,y:0,width:18,height:18},"square-stroked-12":{x:150,y:0,width:12,height:12},"square-24":{x:162,y:0,width:24,height:24},"square-18":{x:186,y:0,width:18,height:18},"square-12":{x:204,y:0,width:12,height:12},"triangle-stroked-24":{x:216,y:0,width:24,height:24},"triangle-stroked-18":{x:240,y:0,width:18,height:18},"triangle-stroked-12":{x:258,y:0,width:12,height:12},"triangle-24":{x:0,y:24,width:24,height:24},"triangle-18":{x:24,y:24,width:18,height:18},"triangle-12":{x:42,y:24,width:12,height:12},"star-stroked-24":{x:54,y:24,width:24,height:24},"star-stroked-18":{x:78,y:24,width:18,height:18},"star-stroked-12":{x:96,y:24,width:12,height:12},"star-24":{x:108,y:24,width:24,height:24},"star-18":{x:132,y:24,width:18,height:18},"star-12":{x:150,y:24,width:12,height:12},"cross-24":{x:162,y:24,width:24,height:24},"cross-18":{x:186,y:24,width:18,height:18},"cross-12":{x:204,y:24,width:12,height:12},"marker-stroked-24":{x:216,y:24,width:24,height:24},"marker-stroked-18":{x:240,y:24,width:18,height:18},"marker-stroked-12":{x:258,y:24,width:12,height:12},"marker-24":{x:0,y:48,width:24,height:24},"marker-18":{x:24,y:48,width:18,height:18},"marker-12":{x:42,y:48,width:12,height:12},"religious-jewish-24":{x:54,y:48,width:24,height:24},"religious-jewish-18":{x:78,y:48,width:18,height:18},"religious-jewish-12":{x:96,y:48,width:12,height:12},"religious-christian-24":{x:108,y:48,width:24,height:24},"religious-christian-18":{x:132,y:48,width:18,height:18},"religious-christian-12":{x:150,y:48,width:12,height:12},"religious-muslim-24":{x:162,y:48,width:24,height:24},"religious-muslim-18":{x:186,y:48,width:18,height:18},"religious-muslim-12":{x:204,y:48,width:12,height:12},"cemetery-24":{x:216,y:48,width:24,height:24},"cemetery-18":{x:240,y:48,width:18,height:18},"cemetery-12":{x:258,y:48,width:12,height:12},"rocket-24":{x:0,y:72,width:24,height:24},"rocket-18":{x:24,y:72,width:18,height:18},"rocket-12":{x:42,y:72,width:12,height:12},"airport-24":{x:54,y:72,width:24,height:24},"airport-18":{x:78,y:72,width:18,height:18},"airport-12":{x:96,y:72,width:12,height:12},"heliport-24":{x:108,y:72,width:24,height:24},"heliport-18":{x:132,y:72,width:18,height:18},"heliport-12":{x:150,y:72,width:12,height:12},"rail-24":{x:162,y:72,width:24,height:24},"rail-18":{x:186,y:72,width:18,height:18},"rail-12":{x:204,y:72,width:12,height:12},"rail-metro-24":{x:216,y:72,width:24,height:24},"rail-metro-18":{x:240,y:72,width:18,height:18},"rail-metro-12":{x:258,y:72,width:12,height:12},"rail-light-24":{x:0,y:96,width:24,height:24},"rail-light-18":{x:24,y:96,width:18,height:18},"rail-light-12":{x:42,y:96,width:12,height:12},"bus-24":{x:54,y:96,width:24,height:24},"bus-18":{x:78,y:96,width:18,height:18},"bus-12":{x:96,y:96,width:12,height:12},"fuel-24":{x:108,y:96,width:24,height:24},"fuel-18":{x:132,y:96,width:18,height:18},"fuel-12":{x:150,y:96,width:12,height:12},"parking-24":{x:162,y:96,width:24,height:24},"parking-18":{x:186,y:96,width:18,height:18},"parking-12":{x:204,y:96,width:12,height:12},"parking-garage-24":{x:216,y:96,width:24,height:24},"parking-garage-18":{x:240,y:96,width:18,height:18},"parking-garage-12":{x:258,y:96,width:12,height:12},"airfield-24":{x:0,y:120,width:24,height:24},"airfield-18":{x:24,y:120,width:18,height:18},"airfield-12":{x:42,y:120,width:12,height:12},"roadblock-24":{x:54,y:120,width:24,height:24},"roadblock-18":{x:78,y:120,width:18,height:18},"roadblock-12":{x:96,y:120,width:12,height:12},"ferry-24":{x:108,y:120,width:24,height:24},"ferry-18":{x:132,y:120,width:18,height:18},"ferry-12":{x:150,y:120,width:12,height:12},"harbor-24":{x:162,y:120,width:24,height:24},"harbor-18":{x:186,y:120,width:18,height:18},"harbor-12":{x:204,y:120,width:12,height:12},"bicycle-24":{x:216,y:120,width:24,height:24},"bicycle-18":{x:240,y:120,width:18,height:18},"bicycle-12":{x:258,y:120,width:12,height:12},"park-24":{x:0,y:144,width:24,height:24},"park-18":{x:24,y:144,width:18,height:18},"park-12":{x:42,y:144,width:12,height:12},"park2-24":{x:54,y:144,width:24,height:24},"park2-18":{x:78,y:144,width:18,height:18},"park2-12":{x:96,y:144,width:12,height:12},"museum-24":{x:108,y:144,width:24,height:24},"museum-18":{x:132,y:144,width:18,height:18},"museum-12":{x:150,y:144,width:12,height:12},"lodging-24":{x:162,y:144,width:24,height:24},"lodging-18":{x:186,y:144,width:18,height:18},"lodging-12":{x:204,y:144,width:12,height:12},"monument-24":{x:216,y:144,width:24,height:24},"monument-18":{x:240,y:144,width:18,height:18},"monument-12":{x:258,y:144,width:12,height:12},"zoo-24":{x:0,y:168,width:24,height:24},"zoo-18":{x:24,y:168,width:18,height:18},"zoo-12":{x:42,y:168,width:12,height:12},"garden-24":{x:54,y:168,width:24,height:24},"garden-18":{x:78,y:168,width:18,height:18},"garden-12":{x:96,y:168,width:12,height:12},"campsite-24":{x:108,y:168,width:24,height:24},"campsite-18":{x:132,y:168,width:18,height:18},"campsite-12":{x:150,y:168,width:12,height:12},"theatre-24":{x:162,y:168,width:24,height:24},"theatre-18":{x:186,y:168,width:18,height:18},"theatre-12":{x:204,y:168,width:12,height:12},"art-gallery-24":{x:216,y:168,width:24,height:24},"art-gallery-18":{x:240,y:168,width:18,height:18},"art-gallery-12":{x:258,y:168,width:12,height:12},"pitch-24":{x:0,y:192,width:24,height:24},"pitch-18":{x:24,y:192,width:18,height:18},"pitch-12":{x:42,y:192,width:12,height:12},"soccer-24":{x:54,y:192,width:24,height:24},"soccer-18":{x:78,y:192,width:18,height:18},"soccer-12":{x:96,y:192,width:12,height:12},"america-football-24":{x:108,y:192,width:24,height:24},"america-football-18":{x:132,y:192,width:18,height:18},"america-football-12":{x:150,y:192,width:12,height:12},"tennis-24":{x:162,y:192,width:24,height:24},"tennis-18":{x:186,y:192,width:18,height:18},"tennis-12":{x:204,y:192,width:12,height:12},"basketball-24":{x:216,y:192,width:24,height:24},"basketball-18":{x:240,y:192,width:18,height:18},"basketball-12":{x:258,y:192,width:12,height:12},"baseball-24":{x:0,y:216,width:24,height:24},"baseball-18":{x:24,y:216,width:18,height:18},"baseball-12":{x:42,y:216,width:12,height:12},"golf-24":{x:54,y:216,width:24,height:24},"golf-18":{x:78,y:216,width:18,height:18},"golf-12":{x:96,y:216,width:12,height:12},"swimming-24":{x:108,y:216,width:24,height:24},"swimming-18":{x:132,y:216,width:18,height:18},"swimming-12":{x:150,y:216,width:12,height:12},"cricket-24":{x:162,y:216,width:24,height:24},"cricket-18":{x:186,y:216,width:18,height:18},"cricket-12":{x:204,y:216,width:12,height:12},"skiing-24":{x:216,y:216,width:24,height:24},"skiing-18":{x:240,y:216,width:18,height:18},"skiing-12":{x:258,y:216,width:12,height:12},"school-24":{x:0,y:240,width:24,height:24},"school-18":{x:24,y:240,width:18,height:18},"school-12":{x:42,y:240,width:12,height:12},"college-24":{x:54,y:240,width:24,height:24},"college-18":{x:78,y:240,width:18,height:18},"college-12":{x:96,y:240,width:12,height:12},"library-24":{x:108,y:240,width:24,height:24},"library-18":{x:132,y:240,width:18,height:18},"library-12":{x:150,y:240,width:12,height:12},"post-24":{x:162,y:240,width:24,height:24},"post-18":{x:186,y:240,width:18,height:18},"post-12":{x:204,y:240,width:12,height:12},"fire-station-24":{x:216,y:240,width:24,height:24},"fire-station-18":{x:240,y:240,width:18,height:18},"fire-station-12":{x:258,y:240,width:12,height:12},"town-hall-24":{x:0,y:264,width:24,height:24},"town-hall-18":{x:24,y:264,width:18,height:18},"town-hall-12":{x:42,y:264,width:12,height:12},"police-24":{x:54,y:264,width:24,height:24},"police-18":{x:78,y:264,width:18,height:18},"police-12":{x:96,y:264,width:12,height:12},"prison-24":{x:108,y:264,width:24,height:24},"prison-18":{x:132,y:264,width:18,height:18},"prison-12":{x:150,y:264,width:12,height:12},"embassy-24":{x:162,y:264,width:24,height:24},"embassy-18":{x:186,y:264,width:18,height:18},"embassy-12":{x:204,y:264,width:12,height:12},"beer-24":{x:216,y:264,width:24,height:24},"beer-18":{x:240,y:264,width:18,height:18},"beer-12":{x:258,y:264,width:12,height:12},"restaurant-24":{x:0,y:288,width:24,height:24},"restaurant-18":{x:24,y:288,width:18,height:18},"restaurant-12":{x:42,y:288,width:12,height:12},"cafe-24":{x:54,y:288,width:24,height:24},"cafe-18":{x:78,y:288,width:18,height:18},"cafe-12":{x:96,y:288,width:12,height:12},"shop-24":{x:108,y:288,width:24,height:24},"shop-18":{x:132,y:288,width:18,height:18},"shop-12":{x:150,y:288,width:12,height:12},"fast-food-24":{x:162,y:288,width:24,height:24},"fast-food-18":{x:186,y:288,width:18,height:18},"fast-food-12":{x:204,y:288,width:12,height:12},"bar-24":{x:216,y:288,width:24,height:24},"bar-18":{x:240,y:288,width:18,height:18},"bar-12":{x:258,y:288,width:12,height:12},"bank-24":{x:0,y:312,width:24,height:24},"bank-18":{x:24,y:312,width:18,height:18},"bank-12":{x:42,y:312,width:12,height:12},"grocery-24":{x:54,y:312,width:24,height:24},"grocery-18":{x:78,y:312,width:18,height:18},"grocery-12":{x:96,y:312,width:12,height:12},"cinema-24":{x:108,y:312,width:24,height:24},"cinema-18":{x:132,y:312,width:18,height:18},"cinema-12":{x:150,y:312,width:12,height:12},"pharmacy-24":{x:162,y:312,width:24,height:24},"pharmacy-18":{x:186,y:312,width:18,height:18},"pharmacy-12":{x:204,y:312,width:12,height:12},"hospital-24":{x:216,y:312,width:24,height:24},"hospital-18":{x:240,y:312,width:18,height:18},"hospital-12":{x:258,y:312,width:12,height:12},"danger-24":{x:0,y:336,width:24,height:24},"danger-18":{x:24,y:336,width:18,height:18},"danger-12":{x:42,y:336,width:12,height:12},"industrial-24":{x:54,y:336,width:24,height:24},"industrial-18":{x:78,y:336,width:18,height:18},"industrial-12":{x:96,y:336,width:12,height:12},"warehouse-24":{x:108,y:336,width:24,height:24},"warehouse-18":{x:132,y:336,width:18,height:18},"warehouse-12":{x:150,y:336,width:12,height:12},"commercial-24":{x:162,y:336,width:24,height:24},"commercial-18":{x:186,y:336,width:18,height:18},"commercial-12":{x:204,y:336,width:12,height:12},"building-24":{x:216,y:336,width:24,height:24},"building-18":{x:240,y:336,width:18,height:18},"building-12":{x:258,y:336,width:12,height:12},"place-of-worship-24":{x:0,y:360,width:24,height:24},"place-of-worship-18":{x:24,y:360,width:18,height:18},"place-of-worship-12":{x:42,y:360,width:12,height:12},"alcohol-shop-24":{x:54,y:360,width:24,height:24},"alcohol-shop-18":{x:78,y:360,width:18,height:18},"alcohol-shop-12":{x:96,y:360,width:12,height:12},"logging-24":{x:108,y:360,width:24,height:24},"logging-18":{x:132,y:360,width:18,height:18},"logging-12":{x:150,y:360,width:12,height:12},"oil-well-24":{x:162,y:360,width:24,height:24},"oil-well-18":{x:186,y:360,width:18,height:18},"oil-well-12":{x:204,y:360,width:12,height:12},"slaughterhouse-24":{x:216,y:360,width:24,height:24},"slaughterhouse-18":{x:240,y:360,width:18,height:18},"slaughterhouse-12":{x:258,y:360,width:12,height:12},"dam-24":{x:0,y:384,width:24,height:24},"dam-18":{x:24,y:384,width:18,height:18},"dam-12":{x:42,y:384,width:12,height:12},"water-24":{x:54,y:384,width:24,height:24},"water-18":{x:78,y:384,width:18,height:18},"water-12":{x:96,y:384,width:12,height:12},"wetland-24":{x:108,y:384,width:24,height:24},"wetland-18":{x:132,y:384,width:18,height:18},"wetland-12":{x:150,y:384,width:12,height:12},"disability-24":{x:162,y:384,width:24,height:24},"disability-18":{x:186,y:384,width:18,height:18},"disability-12":{x:204,y:384,width:12,height:12},"telephone-24":{x:216,y:384,width:24,height:24},"telephone-18":{x:240,y:384,width:18,height:18},"telephone-12":{x:258,y:384,width:12,height:12},"emergency-telephone-24":{x:0,y:408,width:24,height:24},"emergency-telephone-18":{x:24,y:408,width:18,height:18},"emergency-telephone-12":{x:42,y:408,width:12,height:12},"toilets-24":{x:54,y:408,width:24,height:24},"toilets-18":{x:78,y:408,width:18,height:18},"toilets-12":{x:96,y:408,width:12,height:12},"waste-basket-24":{x:108,y:408,width:24,height:24},"waste-basket-18":{x:132,y:408,width:18,height:18},"waste-basket-12":{x:150,y:408,width:12,height:12},"music-24":{x:162,y:408,width:24,height:24},"music-18":{x:186,y:408,width:18,height:18},"music-12":{x:204,y:408,width:12,height:12},"land-use-24":{x:216,y:408,width:24,height:24},"land-use-18":{x:240,y:408,width:18,height:18},"land-use-12":{x:258,y:408,width:12,height:12},"city-24":{x:0,y:432,width:24,height:24},"city-18":{x:24,y:432,width:18,height:18},"city-12":{x:42,y:432,width:12,height:12},"town-24":{x:54,y:432,width:24,height:24},"town-18":{x:78,y:432,width:18,height:18},"town-12":{x:96,y:432,width:12,height:12},"village-24":{x:108,y:432,width:24,height:24},"village-18":{x:132,y:432,width:18,height:18},"village-12":{x:150,y:432,width:12,height:12},"farm-24":{x:162,y:432,width:24,height:24},"farm-18":{x:186,y:432,width:18,height:18},"farm-12":{x:204,y:432,width:12,height:12},"bakery-24":{x:216,y:432,width:24,height:24},"bakery-18":{x:240,y:432,width:18,height:18},"bakery-12":{x:258,y:432,width:12,height:12},"dog-park-24":{x:0,y:456,width:24,height:24},"dog-park-18":{x:24,y:456,width:18,height:18},"dog-park-12":{x:42,y:456,width:12,height:12},"lighthouse-24":{x:54,y:456,width:24,height:24},"lighthouse-18":{x:78,y:456,width:18,height:18},"lighthouse-12":{x:96,y:456,width:12,height:12},"clothing-store-24":{x:108,y:456,width:24,height:24},"clothing-store-18":{x:132,y:456,width:18,height:18},"clothing-store-12":{x:150,y:456,width:12,height:12},"polling-place-24":{x:162,y:456,width:24,height:24},"polling-place-18":{x:186,y:456,width:18,height:18},"polling-place-12":{x:204,y:456,width:12,height:12},"playground-24":{x:216,y:456,width:24,height:24},"playground-18":{x:240,y:456,width:18,height:18},"playground-12":{x:258,y:456,width:12,height:12},"entrance-24":{x:0,y:480,width:24,height:24},"entrance-18":{x:24,y:480,width:18,height:18},"entrance-12":{x:42,y:480,width:12,height:12},"heart-24":{x:54,y:480,width:24,height:24},"heart-18":{x:78,y:480,width:18,height:18},"heart-12":{x:96,y:480,width:12,height:12},"london-underground-24":{x:108,y:480,width:24,height:24},"london-underground-18":{x:132,y:480,width:18,height:18},"london-underground-12":{x:150,y:480,width:12,height:12},"minefield-24":{x:162,y:480,width:24,height:24},"minefield-18":{x:186,y:480,width:18,height:18},"minefield-12":{x:204,y:480,width:12,height:12},"rail-underground-24":{x:216,y:480,width:24,height:24},"rail-underground-18":{x:240,y:480,width:18,height:18},"rail-underground-12":{x:258,y:480,width:12,height:12},"rail-above-24":{x:0,y:504,width:24,height:24},"rail-above-18":{x:24,y:504,width:18,height:18},"rail-above-12":{x:42,y:504,width:12,height:12},"camera-24":{x:54,y:504,width:24,height:24},"camera-18":{x:78,y:504,width:18,height:18},"camera-12":{x:96,y:504,width:12,height:12},"laundry-24":{x:108,y:504,width:24,height:24},"laundry-18":{x:132,y:504,width:18,height:18},"laundry-12":{x:150,y:504,width:12,height:12},"car-24":{x:162,y:504,width:24,height:24},"car-18":{x:186,y:504,width:18,height:18},"car-12":{x:204,y:504,width:12,height:12},"suitcase-24":{x:216,y:504,width:24,height:24},"suitcase-18":{x:240,y:504,width:18,height:18},"suitcase-12":{x:258,y:504,width:12,height:12}}},{}],57:[function(e,t,r){var n=e("./lodash.custom.js");var i=e("geojson-rewind");var a=e("./polygon_features.json");var o={};o=function(e,t){t=n.merge({flatProperties:false,uninterestingTags:{source:true,source_ref:true,"source:ref":true,history:true,attribution:true,created_by:true,"tiger:county":true,"tiger:tlid":true,"tiger:upload_uuid":true},polygonFeatures:a},t);var r;if(typeof XMLDocument!=="undefined"&&e instanceof XMLDocument||typeof XMLDocument==="undefined"&&e.childNodes)r=s(e);else r=o(e);return r;function o(e){var t=new Array;var r=new Array;var i=new Array;for(var a=0;a<e.elements.length;a++){switch(e.elements[a].type){case"node":var o=e.elements[a];t.push(o);break;case"way":var s=n.clone(e.elements[a]);s.nodes=n.clone(s.nodes);r.push(s);break;case"relation":var u=n.clone(e.elements[a]);u.members=n.clone(u.members);i.push(u);break;default:}}return l(t,r,i)}function s(e){function t(e,t,r){if(e.hasAttribute(r))t[r]=e.getAttribute(r)}var r=new Array;var i=new Array;var a=new Array;n.each(e.getElementsByTagName("node"),function(e,i){var a={};n.each(e.getElementsByTagName("tag"),function(e){a[e.getAttribute("k")]=e.getAttribute("v")});r[i]={type:"node"};t(e,r[i],"id");t(e,r[i],"lat");t(e,r[i],"lon");t(e,r[i],"version");t(e,r[i],"timestamp");t(e,r[i],"changeset");t(e,r[i],"uid");t(e,r[i],"user");if(!n.isEmpty(a))r[i].tags=a});n.each(e.getElementsByTagName("way"),function(e,r){var a={};var o=[];n.each(e.getElementsByTagName("tag"),function(e){a[e.getAttribute("k")]=e.getAttribute("v")});n.each(e.getElementsByTagName("nd"),function(e,t){o[t]=e.getAttribute("ref")});i[r]={type:"way"};t(e,i[r],"id");t(e,i[r],"version");t(e,i[r],"timestamp");t(e,i[r],"changeset");t(e,i[r],"uid");t(e,i[r],"user");if(o.length>0)i[r].nodes=o;if(!n.isEmpty(a))i[r].tags=a});n.each(e.getElementsByTagName("relation"),function(e,r){var i={};var o=[];n.each(e.getElementsByTagName("tag"),function(e){i[e.getAttribute("k")]=e.getAttribute("v")});n.each(e.getElementsByTagName("member"),function(e,r){o[r]={};t(e,o[r],"ref");t(e,o[r],"role");t(e,o[r],"type")});a[r]={type:"relation"};t(e,a[r],"id");t(e,a[r],"version");t(e,a[r],"timestamp");t(e,a[r],"changeset");t(e,a[r],"uid");t(e,a[r],"user");if(o.length>0)a[r].members=o;if(!n.isEmpty(i))a[r].tags=i});return l(r,i,a)
}function l(e,r,a){function o(e,r){if(typeof r!=="object")r={};if(typeof t.uninterestingTags==="function")return!t.uninterestingTags(e,r);for(var n in e)if(!(t.uninterestingTags[n]===true)&&!(r[n]===true||r[n]===e[n]))return true;return false}function s(e){var t={timestamp:e.timestamp,version:e.version,changeset:e.changeset,user:e.user,uid:e.uid};for(k in t)if(t[k]===undefined)delete t[k];return t}var l=new Object;for(var c=0;c<e.length;c++){if(e[c].lat===undefined)continue;l[e[c].id]=e[c]}var f=new Object;for(var c=0;c<e.length;c++){if(typeof e[c].tags!="undefined"&&o(e[c].tags))f[e[c].id]=true}for(var c=0;c<a.length;c++){if(!n.isArray(a[c].members))continue;for(var d=0;d<a[c].members.length;d++){if(a[c].members[d].type=="node")f[a[c].members[d].ref]=true}}var h=new Object;var g=new Object;for(var c=0;c<r.length;c++){if(!n.isArray(r[c].nodes))continue;h[r[c].id]=r[c];for(var d=0;d<r[c].nodes.length;d++){g[r[c].nodes[d]]=true;r[c].nodes[d]=l[r[c].nodes[d]]}}var p=new Array;for(var c=0;c<e.length;c++){if(!g[e[c].id]||f[e[c].id])p.push(e[c])}var y=new Array;for(var c=0;c<a.length;c++){if(!n.isArray(a[c].members))continue;y[a[c].id]=a[c]}var m={node:{},way:{},relation:{}};for(var c=0;c<a.length;c++){if(!n.isArray(a[c].members))continue;for(var d=0;d<a[c].members.length;d++){var v;switch(a[c].members[d].type){case"node":v=l[a[c].members[d].ref];break;case"way":v=h[a[c].members[d].ref];break;case"relation":v=y[a[c].members[d].ref];break}if(!v)continue;var w=a[c].members[d].type;var b=a[c].members[d].ref;if(typeof m[w][b]==="undefined")m[w][b]=[];m[w][b].push({role:a[c].members[d].role,rel:a[c].id,reltags:a[c].tags})}}var x;var $={type:"FeatureCollection",features:new Array};for(c=0;c<p.length;c++){if(typeof p[c].lon=="undefined"||typeof p[c].lat=="undefined")continue;$.features.push({type:"Feature",id:"node/"+p[c].id,properties:{type:"node",id:p[c].id,tags:p[c].tags||{},relations:m["node"][p[c].id]||[],meta:s(p[c])},geometry:{type:"Point",coordinates:[+p[c].lon,+p[c].lat]}})}var S={type:"FeatureCollection",features:new Array};var L={type:"FeatureCollection",features:new Array};for(var c=0;c<a.length;c++){if(typeof a[c].tags!="undefined"&&(a[c].tags["type"]=="multipolygon"||a[c].tags["type"]=="boundary")){if(!n.isArray(a[c].members))continue;var E=0;for(var d=0;d<a[c].members.length;d++)if(a[c].members[d].role=="outer")E++;a[c].members.forEach(function(e){if(h[e.ref]){if(e.role==="outer"&&!o(h[e.ref].tags,a[c].tags))h[e.ref].is_multipolygon_outline=true;if(e.role==="inner"&&!o(h[e.ref].tags))h[e.ref].is_multipolygon_outline=true}});if(E==0)continue;var C=false;if(E==1&&!o(a[c].tags,{type:true}))C=true;var M=null;if(!C){M=j(a[c],a[c])}else{var P=a[c].members.filter(function(e){return e.role==="outer"})[0];P=h[P.ref];if(P===undefined)continue;P.is_multipolygon_outline=true;M=j(P,a[c])}if(M===false)continue;L.features.push(M);function j(e,t){var r=false;var i;i=t.members.filter(function(e){return e.type==="way"});i=i.map(function(e){var t=h[e.ref];if(t===undefined){r=true;return}return{id:e.ref,role:e.role||"outer",way:t,nodes:t.nodes.filter(function(e){if(e!==undefined)return true;r=true;return false})}});i=n.compact(i);var a,o;function l(e){var t=function(e){return e[0]};var r=function(e){return e[e.length-1]};var n=[],i,a,o,s,l,u;while(e.length){i=e.pop().nodes.slice();n.push(i);while(e.length&&t(i)!==r(i)){a=t(i);o=r(i);for(s=0;s<e.length;s++){u=e[s].nodes;if(o===t(u)){l=i.push;u=u.slice(1);break}else if(o===r(u)){l=i.push;u=u.slice(0,-1).reverse();break}else if(a==r(u)){l=i.unshift;u=u.slice(0,-1);break}else if(a==t(u)){l=i.unshift;u=u.slice(1).reverse();break}else{u=l=null}}if(!u)break;e.splice(s,1);l.apply(i,u)}}return n}a=l(i.filter(function(e){return e.role==="outer"}));o=l(i.filter(function(e){return e.role==="inner"}));var u;function c(e){var t=function(e,t){for(var r=0;r<t.length;r++)if(n(t[r],e))return true;return false};var r=function(e){return e.map(function(e){return[+e.lat,+e.lon]})};var n=function(e,t){var r=e[0],n=e[1],i=false;for(var a=0,o=t.length-1;a<t.length;o=a++){var s=t[a][0],l=t[a][1];var u=t[o][0],c=t[o][1];var f=l>n!=c>n&&r<(u-s)*(n-l)/(c-l)+s;if(f)i=!i}return i};var i,o;e=r(e);for(i=0;i<a.length;i++){o=r(a[i]);if(t(o,e))return i}}u=a.map(function(e){return[e]});for(var f=0;f<o.length;f++){var d=c(o[f]);if(d!==undefined)u[d].push(o[f]);else;}var g=[];g=n.compact(u.map(function(e){var t=n.compact(e.map(function(e){if(e.length<4)return;return n.compact(e.map(function(e){return[+e.lon,+e.lat]}))}));if(t.length==0)return;return t}));if(g.length==0)return false;var p="MultiPolygon";if(g.length===1){p="Polygon";g=g[0]}var y={type:"Feature",id:e.type+"/"+e.id,properties:{type:e.type,id:e.id,tags:e.tags||{},relations:m[e.type][e.id]||[],meta:s(e)},geometry:{type:p,coordinates:g}};if(r)y.properties["tainted"]=true;return y}}}for(var c=0;c<r.length;c++){if(!n.isArray(r[c].nodes))continue;if(r[c].is_multipolygon_outline)continue;r[c].tainted=false;r[c].hidden=false;coords=new Array;for(d=0;d<r[c].nodes.length;d++){if(typeof r[c].nodes[d]=="object")coords.push([+r[c].nodes[d].lon,+r[c].nodes[d].lat]);else r[c].tainted=true}if(coords.length<=1)continue;var T="LineString";if(typeof r[c].nodes[0]!="undefined"&&r[c].nodes[0]===r[c].nodes[r[c].nodes.length-1]&&typeof r[c].tags!="undefined"&&u(r[c].tags)){T="Polygon";coords=[coords]}var M={type:"Feature",id:"way/"+r[c].id,properties:{type:"way",id:r[c].id,tags:r[c].tags||{},relations:m["way"][r[c].id]||[],meta:s(r[c])},geometry:{type:T,coordinates:coords}};if(r[c].tainted)M.properties["tainted"]=true;if(T=="LineString")S.features.push(M);else L.features.push(M)}x={type:"FeatureCollection",features:[]};x.features=x.features.concat(L.features);x.features=x.features.concat(S.features);x.features=x.features.concat($.features);if(t.flatProperties){x.features.forEach(function(e){e.properties=n.merge(e.properties.meta,e.properties.tags,{id:e.properties.type+"/"+e.properties.id})})}x=i(x,true);return x}function u(e){var r=t.polygonFeatures;if(typeof r==="function")return r(e);if(e["area"]==="no")return false;for(var n in e){var i=e[n];var a=r[n];if(typeof a==="undefined")continue;if(i==="no")continue;if(a===true)return true;if(a.included_values&&a.included_values[i]===true)return true;if(a.excluded_values&&a.excluded_values[i]!==true)return true}return false}};o.toGeojson=o;t.exports=o},{"./lodash.custom.js":58,"./polygon_features.json":62,"geojson-rewind":59}],58:[function(e,t,r){(function(e){(function(){var n=[];var i={};var a=40;var o=/\w*$/;var s=/^\s*function[ \n\r\t]+\w/;var l=/\bthis\b/;var u=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];var c="[object Arguments]",f="[object Array]",d="[object Boolean]",h="[object Date]",g="[object Error]",p="[object Function]",y="[object Number]",m="[object Object]",v="[object RegExp]",w="[object String]";var b={};b[p]=false;b[c]=b[f]=b[d]=b[h]=b[y]=b[m]=b[v]=b[w]=true;var x={configurable:false,enumerable:false,value:null,writable:false};var $={args:"",array:null,bottom:"",firstArg:"",init:"",keys:null,loop:"",shadowedProps:null,support:null,top:"",useHas:false};var S={"boolean":false,"function":true,object:true,number:false,string:false,undefined:false};var L=S[typeof window]&&window||this;var E=S[typeof r]&&r&&!r.nodeType&&r;var C=S[typeof t]&&t&&!t.nodeType&&t;var M=C&&C.exports===E&&E;var P=S[typeof e]&&e;if(P&&(P.global===P||P.window===P)){L=P}function j(){return n.pop()||[]}function T(e){return typeof e.toString!="function"&&typeof(e+"")=="string"}function _(e){e.length=0;if(n.length<a){n.push(e)}}function A(e,t,r){t||(t=0);if(typeof r=="undefined"){r=e?e.length:0}var n=-1,i=r-t||0,a=Array(i<0?0:i);while(++n<i){a[n]=e[t+n]}return a}var I=[];var F=Error.prototype,O=Object.prototype,B=String.prototype;var q=O.toString;var D=RegExp("^"+String(q).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");var z=Function.prototype.toString,U=ut(U=Object.getPrototypeOf)&&U,N=O.hasOwnProperty,G=I.push,R=O.propertyIsEnumerable,V=I.unshift;var Z=function(){try{var e={},t=ut(t=Object.defineProperty)&&t,r=t(e,e,e)&&t}catch(n){}return r}();var W=ut(W=Object.create)&&W,H=ut(H=Array.isArray)&&H,J=ut(J=Object.keys)&&J;var X={};X[f]=Array;X[d]=Boolean;X[h]=Date;X[p]=Function;X[m]=Object;X[y]=Number;X[v]=RegExp;X[w]=String;var K={};K[f]=K[h]=K[y]={constructor:true,toLocaleString:true,toString:true,valueOf:true};K[d]=K[w]={constructor:true,toString:true,valueOf:true};K[g]=K[p]=K[v]={constructor:true,toString:true};K[m]={constructor:true};(function(){var e=u.length;while(e--){var t=u[e];for(var r in K){if(N.call(K,r)&&!N.call(K[r],t)){K[r][t]=false}}}})();function Q(){}var Y=Q.support={};(function(){var e=function(){this.x=1},t={0:1,length:1},r=[];e.prototype={valueOf:1,y:1};for(var n in new e){r.push(n)}for(n in arguments){}Y.argsClass=q.call(arguments)==c;Y.argsObject=arguments.constructor==Object&&!(arguments instanceof Array);Y.enumErrorProps=R.call(F,"message")||R.call(F,"name");Y.enumPrototypes=R.call(e,"prototype");Y.funcDecomp=!ut(L.WinRTError)&&l.test(function(){return this});Y.funcNames=typeof Function.name=="string";Y.nonEnumArgs=n!=0;Y.nonEnumShadows=!/valueOf/.test(r);Y.ownLast=r[0]!="x";Y.spliceObjects=(I.splice.call(t,0,1),!t[0]);Y.unindexedChars="x"[0]+Object("x")[0]!="xx";try{Y.nodeClass=!(q.call(document)==m&&!({toString:0}+""))}catch(i){Y.nodeClass=true}})(1);var et=function(e){var t="var index, iterable = "+e.firstArg+", result = "+e.init+";\nif (!iterable) return result;\n"+e.top+";";if(e.array){t+="\nvar length = iterable.length; index = -1;\nif ("+e.array+") {  ";if(Y.unindexedChars){t+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "}t+="\n  while (++index < length) {\n    "+e.loop+";\n  }\n}\nelse {  "}else if(Y.nonEnumArgs){t+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+e.loop+";\n    }\n  } else {  "}if(Y.enumPrototypes){t+="\n  var skipProto = typeof iterable == 'function';\n  "}if(Y.enumErrorProps){t+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  "}var r=[];if(Y.enumPrototypes){r.push('!(skipProto && index == "prototype")')}if(Y.enumErrorProps){r.push('!(skipErrorProps && (index == "message" || index == "name"))')}if(e.useHas&&e.keys){t+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n";if(r.length){t+="    if ("+r.join(" && ")+") {\n  "}t+=e.loop+";    ";if(r.length){t+="\n    }"}t+="\n  }  "}else{t+="\n  for (index in iterable) {\n";if(e.useHas){r.push("hasOwnProperty.call(iterable, index)")}if(r.length){t+="    if ("+r.join(" && ")+") {\n  "}t+=e.loop+";    ";if(r.length){t+="\n    }"}t+="\n  }    ";if(Y.nonEnumShadows){t+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ";for(k=0;k<7;k++){t+="\n    index = '"+e.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))";if(!e.useHas){t+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"}t+=") {\n      "+e.loop+";\n    }      "}t+="\n  }    "}}if(e.array||Y.nonEnumArgs){t+="\n}"}t+=e.bottom+";\nreturn result";return t};function tt(e){var t=e[0],r=e[2],n=e[4];function i(){if(r){var e=A(r);G.apply(e,arguments)}if(this instanceof i){var a=nt(t.prototype),o=t.apply(a,e||arguments);return Et(o)?o:a}return t.apply(n,e||arguments)}ct(i,e);return i}function rt(e,t,r,n,i){if(r){var a=r(e);if(typeof a!="undefined"){return a}}var s=Et(e);if(s){var l=q.call(e);if(!b[l]||!Y.nodeClass&&T(e)){return e}var u=X[l];switch(l){case d:case h:return new u(+e);case y:case w:return new u(e);case v:a=u(e.source,o.exec(e));a.lastIndex=e.lastIndex;return a}}else{return e}var c=ht(e);if(t){var f=!n;n||(n=j());i||(i=j());var g=n.length;while(g--){if(n[g]==e){return i[g]}}a=c?u(e.length):{}}else{a=c?A(e):bt({},e)}if(c){if(N.call(e,"index")){a.index=e.index}if(N.call(e,"input")){a.input=e.input}}if(!t){return a}n.push(e);i.push(a);(c?wt:$t)(e,function(e,o){a[o]=rt(e,t,r,n,i)});if(f){_(n);_(i)}return a}function nt(e,t){return Et(e)?W(e):{}}if(!W){nt=function(){function e(){}return function(t){if(Et(t)){e.prototype=t;var r=new e;e.prototype=null}return r||L.Object()}}()}function it(e,t,r){if(typeof e!="function"){return At}if(typeof t=="undefined"||!("prototype"in e)){return e}var n=e.__bindData__;if(typeof n=="undefined"){if(Y.funcNames){n=!e.name}n=n||!Y.funcDecomp;if(!n){var i=z.call(e);if(!Y.funcNames){n=!s.test(i)}if(!n){n=l.test(i);ct(e,n)}}}if(n===false||n!==true&&n[1]&1){return e}switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)};case 4:return function(r,n,i,a){return e.call(t,r,n,i,a)}}return _t(e,t)}function at(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5];var s=r&1,l=r&2,u=r&4,c=r&8,f=t;function d(){var e=s?a:this;if(n){var h=A(n);G.apply(h,arguments)}if(i||u){h||(h=A(arguments));if(i){G.apply(h,i)}if(u&&h.length<o){r|=16&~32;return at([t,c?r:r&~3,h,null,a,o])}}h||(h=arguments);if(l){t=e[f]}if(this instanceof d){e=nt(t.prototype);var g=t.apply(e,h);return Et(g)?g:e}return t.apply(e,h)}ct(d,e);return d}function ot(e,t,r,n,i){(ht(t)?jt:$t)(t,function(t,a){var o,s,l=t,u=e[a];if(t&&((s=ht(t))||Ct(t))){var c=n.length;while(c--){if(o=n[c]==t){u=i[c];break}}if(!o){var f;if(r){l=r(u,t);if(f=typeof l!="undefined"){u=l}}if(!f){u=s?ht(u)?u:[]:Ct(u)?u:{}}n.push(t);i.push(u);if(!f){ot(u,t,r,n,i)}}}else{if(r){l=r(u,t);if(typeof l=="undefined"){l=t}}if(typeof l!="undefined"){u=l}}e[a]=u})}function st(e,t,r,n,i,a){var o=t&1,s=t&2,l=t&4,u=t&8,c=t&16,f=t&32;if(!s&&!Lt(e)){throw new TypeError}if(c&&!r.length){t&=~16;c=r=false}if(f&&!n.length){t&=~32;f=n=false}var d=e&&e.__bindData__;if(d&&d!==true){d=A(d);if(d[2]){d[2]=A(d[2])}if(d[3]){d[3]=A(d[3])}if(o&&!(d[1]&1)){d[4]=i}if(!o&&d[1]&1){t|=8}if(l&&!(d[1]&4)){d[5]=a}if(c){G.apply(d[2]||(d[2]=[]),r)}if(f){V.apply(d[3]||(d[3]=[]),n)}d[1]|=t;return st.apply(null,d)}var h=t==1||t===17?tt:at;return h([e,t,r,n,i,a])}function lt(){$.shadowedProps=u;$.array=$.bottom=$.loop=$.top="";$.init="iterable";$.useHas=true;for(var e,t=0;e=arguments[t];t++){for(var r in e){$[r]=e[r]}}var n=$.args;$.firstArg=/^[^,]+/.exec(n)[0];var a=Function("baseCreateCallback, errorClass, errorProto, hasOwnProperty, "+"indicatorObject, isArguments, isArray, isString, keys, objectProto, "+"objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+n+") {\n"+et($)+"\n}");return a(it,g,F,N,i,dt,ht,Mt,$.keys,O,S,K,w,B,q)}function ut(e){return typeof e=="function"&&D.test(e)}var ct=!Z?It:function(e,t){x.value=t;Z(e,"__bindData__",x)};function ft(e){var t,r;if(!(e&&q.call(e)==m)||(t=e.constructor,Lt(t)&&!(t instanceof t))||!Y.argsClass&&dt(e)||!Y.nodeClass&&T(e)){return false}if(Y.ownLast){kt(e,function(e,t,n){r=N.call(n,t);return false});return r!==false}kt(e,function(e,t){r=t});return typeof r=="undefined"||N.call(e,r)}function dt(e){return e&&typeof e=="object"&&typeof e.length=="number"&&q.call(e)==c||false}if(!Y.argsClass){dt=function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&N.call(e,"callee")&&!R.call(e,"callee")||false}}var ht=H||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&q.call(e)==f||false};var gt=lt({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"});var pt=!J?gt:function(e){if(!Et(e)){return[]}if(Y.enumPrototypes&&typeof e=="function"||Y.nonEnumArgs&&e.length&&dt(e)){return gt(e)}return J(e)};var yt={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",array:"typeof length == 'number'",keys:pt,loop:"if (callback(iterable[index], index, collection) === false) return result"};var mt={args:"object, source, guard",top:"var args = arguments,\n"+"    argsIndex = 0,\n"+"    argsLength = typeof guard == 'number' ? 2 : args.length;\n"+"while (++argsIndex < argsLength) {\n"+"  iterable = args[argsIndex];\n"+"  if (iterable && objectTypes[typeof iterable]) {",keys:pt,loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"};var vt={top:"if (!objectTypes[typeof iterable]) return result;\n"+yt.top,array:false};var wt=lt(yt);var bt=lt(mt,{top:mt.top.replace(";",";\n"+"if (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n"+"  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n"+"} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n"+"  callback = args[--argsLength];\n"+"}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"});function xt(e,t,r,n){if(typeof t!="boolean"&&t!=null){n=r;r=t;t=false}return rt(e,t,typeof r=="function"&&it(r,n,1))}var kt=lt(yt,vt,{useHas:false});var $t=lt(yt,vt);function St(e){var t=true;if(!e){return t}var r=q.call(e),n=e.length;if(r==f||r==w||(Y.argsClass?r==c:dt(e))||r==m&&typeof n=="number"&&Lt(e.splice)){return!n}$t(e,function(){return t=false});return t}function Lt(e){return typeof e=="function"}if(Lt(/x/)){Lt=function(e){return typeof e=="function"&&q.call(e)==p}}function Et(e){return!!(e&&S[typeof e])}var Ct=!U?ft:function(e){if(!(e&&q.call(e)==m)||!Y.argsClass&&dt(e)){return false}var t=e.valueOf,r=ut(t)&&(r=U(t))&&U(r);return r?e==r||U(e)==r:ft(e)};function Mt(e){return typeof e=="string"||e&&typeof e=="object"&&q.call(e)==w||false}function Pt(e){var t=arguments,r=2;if(!Et(e)){return e}if(typeof t[2]!="number"){r=t.length}if(r>3&&typeof t[r-2]=="function"){var n=it(t[--r-1],t[r--],2)}else if(r>2&&typeof t[r-1]=="function"){n=t[--r]}var i=A(arguments,1,r),a=-1,o=j(),s=j();while(++a<r){ot(e,i[a],n,o,s)}_(o);_(s);return e}function jt(e,t,r){if(t&&typeof r=="undefined"&&ht(e)){var n=-1,i=e.length;while(++n<i){if(t(e[n],n,e)===false){break}}}else{wt(e,t,r)}return e}function Tt(e){var t=-1,r=e?e.length:0,n=[];while(++t<r){var i=e[t];if(i){n.push(i)}}return n}function _t(e,t){return arguments.length>2?st(e,17,A(arguments,2),null,t):st(e,1,null,null,t)}function At(e){return e}function It(){}Q.assign=bt;Q.bind=_t;Q.compact=Tt;Q.forEach=jt;Q.forIn=kt;Q.forOwn=$t;Q.keys=pt;Q.merge=Pt;Q.each=jt;Q.extend=bt;Q.clone=xt;Q.identity=At;Q.isArguments=dt;Q.isArray=ht;Q.isEmpty=St;Q.isFunction=Lt;Q.isObject=Et;Q.isPlainObject=Ct;Q.isString=Mt;Q.noop=It;Q.VERSION="2.4.1";if(E&&C){if(M){(C.exports=Q)._=Q}}}).call(this)}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],59:[function(e,t,r){var n=e("geojson-area");t.exports=i;function i(e,t){switch(e&&e.type||null){case"FeatureCollection":e.features=e.features.map(a(i,t));return e;case"Feature":e.geometry=i(e.geometry,t);return e;case"Polygon":case"MultiPolygon":return o(e,t);default:return e}}function a(e,t){return function(r){return e(r,t)}}function o(e,t){if(e.type==="Polygon"){e.coordinates=s(e.coordinates,t)}else if(e.type==="MultiPolygon"){e.coordinates=e.coordinates.map(a(s,t))}return e}function s(e,t){t=!!t;e[0]=l(e[0],!t);for(var r=1;r<e.length;r++){e[r]=l(e[r],t)}return e}function l(e,t){return u(e)===t?e:e.reverse()}function u(e){return n.ring(e)>=0}},{"geojson-area":60}],60:[function(e,t,r){var n=e("wgs84");t.exports.geometry=i;t.exports.ring=o;function i(e){if(e.type==="Polygon")return a(e.coordinates);else if(e.type==="MultiPolygon"){var t=0;for(var r=0;r<e.coordinates.length;r++){t+=a(e.coordinates[r])}return t}else{return null}}function a(e){var t=0;if(e&&e.length>0){t+=Math.abs(o(e[0]));for(var r=1;r<e.length;r++){t-=Math.abs(o(e[r]))}}return t}function o(e){var t=0;if(e.length>2){var r,i;for(var a=0;a<e.length-1;a++){r=e[a];i=e[a+1];t+=s(i[0]-r[0])*(2+Math.sin(s(r[1]))+Math.sin(s(i[1])))}t=t*n.RADIUS*n.RADIUS/2}return t}function s(e){return e*Math.PI/180}},{wgs84:61}],61:[function(e,t,r){t.exports.RADIUS=6378137;t.exports.FLATTENING=1/298.257223563;t.exports.POLAR_RADIUS=6356752.3142},{}],62:[function(e,t,r){t.exports={building:true,highway:{included_values:{services:true,rest_area:true,escape:true}},natural:{excluded_values:{coastline:true,ridge:true,arete:true,tree_row:true}},landuse:true,waterway:{included_values:{riverbank:true,dock:true,boatyard:true,dam:true}},amenity:true,leisure:true,barrier:{included_values:{city_wall:true,ditch:true,hedge:true,retaining_wall:true,wall:true,spikes:true}},railway:{included_values:{station:true,turntable:true,roundhouse:true,platform:true}},area:true,boundary:true,man_made:{excluded_values:{cutline:true,embankment:true,pipeline:true}},power:{included_values:{generator:true,station:true,sub_station:true,transformer:true}},place:true,shop:true,aeroway:{excluded_values:{taxiway:true}},tourism:true,historic:true,public_transport:true,office:true,"building:part":true,military:true,ruins:true,"area:highway":true,craft:true}},{}],63:[function(e,t,r){(function(n){toGeoJSON=function(){"use strict";var t=/\s*/g,i=/^\s*|\s*$/g,a=/\s+/;function o(e){if(!e||!e.length)return 0;for(var t=0,r=0;t<e.length;t++){r=(r<<5)-r+e.charCodeAt(t)|0}return r}function s(e,t){return e.getElementsByTagName(t)}function l(e,t){return e.getAttribute(t)}function u(e,t){return parseFloat(l(e,t))}function c(e,t){var r=s(e,t);return r.length?r[0]:null}function f(e){if(e.normalize){e.normalize()}return e}function d(e){for(var t=0,r=[];t<e.length;t++)r[t]=parseFloat(e[t]);return r}function h(e){var t={};for(var r in e)if(e[r])t[r]=e[r];return t}function g(e){if(e){f(e)}return e&&e.firstChild&&e.firstChild.nodeValue}function p(e){return d(e.replace(t,"").split(","))}function y(e){var t=e.replace(i,"").split(a),r=[];for(var n=0;n<t.length;n++){r.push(p(t[n]))}return r}function m(e){var t=[u(e,"lon"),u(e,"lat")],r=c(e,"ele");if(r)t.push(parseFloat(g(r)));return t}function v(){return{type:"FeatureCollection",features:[]}}var w;if(typeof XMLSerializer!=="undefined"){w=new XMLSerializer}else if(typeof r==="object"&&typeof n==="object"&&!n.browser){w=new(e("xmldom").XMLSerializer)}function b(e){return w.serializeToString(e)}var x={kml:function(e,t){t=t||{};var r=v(),n={},i=["Polygon","LineString","Point","Track"],a=s(e,"Placemark"),u=s(e,"Style");for(var f=0;f<u.length;f++){n["#"+l(u[f],"id")]=o(b(u[f])).toString(16)}for(var h=0;h<a.length;h++){r.features=r.features.concat(k(a[h]))}function m(e){return d(e.split(" "))}function w(e){var t=s(e,"coord","gx"),r=[];for(var n=0;n<t.length;n++)r.push(m(g(t[n])));return r}function x(e){var t,r,n,a,o,l=[];if(c(e,"MultiGeometry"))return x(c(e,"MultiGeometry"));if(c(e,"MultiTrack"))return x(c(e,"MultiTrack"));for(n=0;n<i.length;n++){r=s(e,i[n]);if(r){for(a=0;a<r.length;a++){t=r[a];if(i[n]=="Point"){l.push({type:"Point",coordinates:p(g(c(t,"coordinates")))})}else if(i[n]=="LineString"){l.push({type:"LineString",coordinates:y(g(c(t,"coordinates")))})}else if(i[n]=="Polygon"){var u=s(t,"LinearRing"),f=[];for(o=0;o<u.length;o++){f.push(y(g(c(u[o],"coordinates"))))}l.push({type:"Polygon",coordinates:f})}else if(i[n]=="Track"){l.push({type:"LineString",coordinates:w(t)})}}}}return l}function k(e){var t=x(e),r,i={},a=g(c(e,"name")),o=g(c(e,"styleUrl")),l=g(c(e,"description")),u=c(e,"TimeSpan"),f=c(e,"ExtendedData");if(!t.length)return[];if(a)i.name=a;if(o&&n[o]){i.styleUrl=o;i.styleHash=n[o]}if(l)i.description=l;if(u){var d=g(c(u,"begin"));var h=g(c(u,"end"));i.timespan={begin:d,end:h}}if(f){var p=s(f,"Data"),y=s(f,"SimpleData");for(r=0;r<p.length;r++){i[p[r].getAttribute("name")]=g(c(p[r],"value"))}for(r=0;r<y.length;r++){i[y[r].getAttribute("name")]=g(y[r])}}return[{type:"Feature",geometry:t.length===1?t[0]:{type:"GeometryCollection",geometries:t},properties:i}]}return r},gpx:function(e,t){var r,n=s(e,"trk"),i=s(e,"rte"),a=s(e,"wpt"),o=v();for(r=0;r<n.length;r++){o.features.push(l(n[r],"trkpt"))}for(r=0;r<i.length;r++){o.features.push(l(i[r],"rtept"))}for(r=0;r<a.length;r++){o.features.push(u(a[r]))}function l(e,t){var r,n=s(e,t),i=[];for(r=0;r<n.length;r++){i.push(m(n[r]))}return{type:"Feature",properties:f(e),geometry:{type:"LineString",coordinates:i}}}function u(e){var t=f(e);t.sym=g(c(e,"sym"));return{type:"Feature",properties:t,geometry:{type:"Point",coordinates:m(e)}}}function f(e){var t=["name","desc","author","copyright","link","time","keywords"],r={},n;for(n=0;n<t.length;n++){r[t[n]]=g(c(e,t[n]))}return h(r)}return o}};return x}();if(typeof t!=="undefined")t.exports=toGeoJSON}).call(this,e("/home/miguelpeixe/devel/riversproject/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"/home/miguelpeixe/devel/riversproject/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":51,xmldom:50}],topojson:[function(e,t,r){t.exports=e("BOmyIj")},{}],BOmyIj:[function(e,t,r){var n=e("fs");var i=t.exports=new Function("topojson","return "+'topojson = (function() {\n\n  function merge(topology, arcs) {\n    var fragmentByStart = {},\n        fragmentByEnd = {};\n\n    arcs.forEach(function(i) {\n      var e = ends(i),\n          start = e[0],\n          end = e[1],\n          f, g;\n\n      if (f = fragmentByEnd[start]) {\n        delete fragmentByEnd[f.end];\n        f.push(i);\n        f.end = end;\n        if (g = fragmentByStart[end]) {\n          delete fragmentByStart[g.start];\n          var fg = g === f ? f : f.concat(g);\n          fragmentByStart[fg.start = f.start] = fragmentByEnd[fg.end = g.end] = fg;\n        } else if (g = fragmentByEnd[end]) {\n          delete fragmentByStart[g.start];\n          delete fragmentByEnd[g.end];\n          var fg = f.concat(g.map(function(i) { return ~i; }).reverse());\n          fragmentByStart[fg.start = f.start] = fragmentByEnd[fg.end = g.start] = fg;\n        } else {\n          fragmentByStart[f.start] = fragmentByEnd[f.end] = f;\n        }\n      } else if (f = fragmentByStart[end]) {\n        delete fragmentByStart[f.start];\n        f.unshift(i);\n        f.start = start;\n        if (g = fragmentByEnd[start]) {\n          delete fragmentByEnd[g.end];\n          var gf = g === f ? f : g.concat(f);\n          fragmentByStart[gf.start = g.start] = fragmentByEnd[gf.end = f.end] = gf;\n        } else if (g = fragmentByStart[start]) {\n          delete fragmentByStart[g.start];\n          delete fragmentByEnd[g.end];\n          var gf = g.map(function(i) { return ~i; }).reverse().concat(f);\n          fragmentByStart[gf.start = g.end] = fragmentByEnd[gf.end = f.end] = gf;\n        } else {\n          fragmentByStart[f.start] = fragmentByEnd[f.end] = f;\n        }\n      } else if (f = fragmentByStart[start]) {\n        delete fragmentByStart[f.start];\n        f.unshift(~i);\n        f.start = end;\n        if (g = fragmentByEnd[end]) {\n          delete fragmentByEnd[g.end];\n          var gf = g === f ? f : g.concat(f);\n          fragmentByStart[gf.start = g.start] = fragmentByEnd[gf.end = f.end] = gf;\n        } else if (g = fragmentByStart[end]) {\n          delete fragmentByStart[g.start];\n          delete fragmentByEnd[g.end];\n          var gf = g.map(function(i) { return ~i; }).reverse().concat(f);\n          fragmentByStart[gf.start = g.end] = fragmentByEnd[gf.end = f.end] = gf;\n        } else {\n          fragmentByStart[f.start] = fragmentByEnd[f.end] = f;\n        }\n      } else if (f = fragmentByEnd[end]) {\n        delete fragmentByEnd[f.end];\n        f.push(~i);\n        f.end = start;\n        if (g = fragmentByEnd[start]) {\n          delete fragmentByStart[g.start];\n          var fg = g === f ? f : f.concat(g);\n          fragmentByStart[fg.start = f.start] = fragmentByEnd[fg.end = g.end] = fg;\n        } else if (g = fragmentByStart[start]) {\n          delete fragmentByStart[g.start];\n          delete fragmentByEnd[g.end];\n          var fg = f.concat(g.map(function(i) { return ~i; }).reverse());\n          fragmentByStart[fg.start = f.start] = fragmentByEnd[fg.end = g.start] = fg;\n        } else {\n          fragmentByStart[f.start] = fragmentByEnd[f.end] = f;\n        }\n      } else {\n        f = [i];\n        fragmentByStart[f.start = start] = fragmentByEnd[f.end = end] = f;\n      }\n    });\n\n    function ends(i) {\n      var arc = topology.arcs[i], p0 = arc[0], p1 = [0, 0];\n      arc.forEach(function(dp) { p1[0] += dp[0], p1[1] += dp[1]; });\n      return [p0, p1];\n    }\n\n    var fragments = [];\n    for (var k in fragmentByEnd) fragments.push(fragmentByEnd[k]);\n    return fragments;\n  }\n\n  function mesh(topology, o, filter) {\n    var arcs = [];\n\n    if (arguments.length > 1) {\n      var geomsByArc = [],\n          geom;\n\n      function arc(i) {\n        if (i < 0) i = ~i;\n        (geomsByArc[i] || (geomsByArc[i] = [])).push(geom);\n      }\n\n      function line(arcs) {\n        arcs.forEach(arc);\n      }\n\n      function polygon(arcs) {\n        arcs.forEach(line);\n      }\n\n      function geometry(o) {\n        if (o.type === "GeometryCollection") o.geometries.forEach(geometry);\n        else if (o.type in geometryType) {\n          geom = o;\n          geometryType[o.type](o.arcs);\n        }\n      }\n\n      var geometryType = {\n        LineString: line,\n        MultiLineString: polygon,\n        Polygon: polygon,\n        MultiPolygon: function(arcs) { arcs.forEach(polygon); }\n      };\n\n      geometry(o);\n\n      geomsByArc.forEach(arguments.length < 3\n          ? function(geoms, i) { arcs.push(i); }\n          : function(geoms, i) { if (filter(geoms[0], geoms[geoms.length - 1])) arcs.push(i); });\n    } else {\n      for (var i = 0, n = topology.arcs.length; i < n; ++i) arcs.push(i);\n    }\n\n    return object(topology, {type: "MultiLineString", arcs: merge(topology, arcs)});\n  }\n\n  function featureOrCollection(topology, o) {\n    return o.type === "GeometryCollection" ? {\n      type: "FeatureCollection",\n      features: o.geometries.map(function(o) { return feature(topology, o); })\n    } : feature(topology, o);\n  }\n\n  function feature(topology, o) {\n    var f = {\n      type: "Feature",\n      id: o.id,\n      properties: o.properties || {},\n      geometry: object(topology, o)\n    };\n    if (o.id == null) delete f.id;\n    return f;\n  }\n\n  function object(topology, o) {\n    var absolute = transformAbsolute(topology.transform),\n        arcs = topology.arcs;\n\n    function arc(i, points) {\n      if (points.length) points.pop();\n      for (var a = arcs[i < 0 ? ~i : i], k = 0, n = a.length, p; k < n; ++k) {\n        points.push(p = a[k].slice());\n        absolute(p, k);\n      }\n      if (i < 0) reverse(points, n);\n    }\n\n    function point(p) {\n      p = p.slice();\n      absolute(p, 0);\n      return p;\n    }\n\n    function line(arcs) {\n      var points = [];\n      for (var i = 0, n = arcs.length; i < n; ++i) arc(arcs[i], points);\n      if (points.length < 2) points.push(points[0].slice());\n      return points;\n    }\n\n    function ring(arcs) {\n      var points = line(arcs);\n      while (points.length < 4) points.push(points[0].slice());\n      return points;\n    }\n\n    function polygon(arcs) {\n      return arcs.map(ring);\n    }\n\n    function geometry(o) {\n      var t = o.type;\n      return t === "GeometryCollection" ? {type: t, geometries: o.geometries.map(geometry)}\n          : t in geometryType ? {type: t, coordinates: geometryType[t](o)}\n          : null;\n    }\n\n    var geometryType = {\n      Point: function(o) { return point(o.coordinates); },\n      MultiPoint: function(o) { return o.coordinates.map(point); },\n      LineString: function(o) { return line(o.arcs); },\n      MultiLineString: function(o) { return o.arcs.map(line); },\n      Polygon: function(o) { return polygon(o.arcs); },\n      MultiPolygon: function(o) { return o.arcs.map(polygon); }\n    };\n\n    return geometry(o);\n  }\n\n  function reverse(array, n) {\n    var t, j = array.length, i = j - n; while (i < --j) t = array[i], array[i++] = array[j], array[j] = t;\n  }\n\n  function bisect(a, x) {\n    var lo = 0, hi = a.length;\n    while (lo < hi) {\n      var mid = lo + hi >>> 1;\n      if (a[mid] < x) lo = mid + 1;\n      else hi = mid;\n    }\n    return lo;\n  }\n\n  function neighbors(objects) {\n    var indexesByArc = {}, // arc index -> array of object indexes\n        neighbors = objects.map(function() { return []; });\n\n    function line(arcs, i) {\n      arcs.forEach(function(a) {\n        if (a < 0) a = ~a;\n        var o = indexesByArc[a];\n        if (o) o.push(i);\n        else indexesByArc[a] = [i];\n      });\n    }\n\n    function polygon(arcs, i) {\n      arcs.forEach(function(arc) { line(arc, i); });\n    }\n\n    function geometry(o, i) {\n      if (o.type === "GeometryCollection") o.geometries.forEach(function(o) { geometry(o, i); });\n      else if (o.type in geometryType) geometryType[o.type](o.arcs, i);\n    }\n\n    var geometryType = {\n      LineString: line,\n      MultiLineString: polygon,\n      Polygon: polygon,\n      MultiPolygon: function(arcs, i) { arcs.forEach(function(arc) { polygon(arc, i); }); }\n    };\n\n    objects.forEach(geometry);\n\n    for (var i in indexesByArc) {\n      for (var indexes = indexesByArc[i], m = indexes.length, j = 0; j < m; ++j) {\n        for (var k = j + 1; k < m; ++k) {\n          var ij = indexes[j], ik = indexes[k], n;\n          if ((n = neighbors[ij])[i = bisect(n, ik)] !== ik) n.splice(i, 0, ik);\n          if ((n = neighbors[ik])[i = bisect(n, ij)] !== ij) n.splice(i, 0, ij);\n        }\n      }\n    }\n\n    return neighbors;\n  }\n\n  function presimplify(topology, triangleArea) {\n    var absolute = transformAbsolute(topology.transform),\n        relative = transformRelative(topology.transform),\n        heap = minHeap(compareArea),\n        maxArea = 0,\n        triangle;\n\n    if (!triangleArea) triangleArea = cartesianArea;\n\n    topology.arcs.forEach(function(arc) {\n      var triangles = [];\n\n      arc.forEach(absolute);\n\n      for (var i = 1, n = arc.length - 1; i < n; ++i) {\n        triangle = arc.slice(i - 1, i + 2);\n        triangle[1][2] = triangleArea(triangle);\n        triangles.push(triangle);\n        heap.push(triangle);\n      }\n\n      // Always keep the arc endpoints!\n      arc[0][2] = arc[n][2] = Infinity;\n\n      for (var i = 0, n = triangles.length; i < n; ++i) {\n        triangle = triangles[i];\n        triangle.previous = triangles[i - 1];\n        triangle.next = triangles[i + 1];\n      }\n    });\n\n    while (triangle = heap.pop()) {\n      var previous = triangle.previous,\n          next = triangle.next;\n\n      // If the area of the current point is less than that of the previous point\n      // to be eliminated, use the latter\'s area instead. This ensures that the\n      // current point cannot be eliminated without eliminating previously-\n      // eliminated points.\n      if (triangle[1][2] < maxArea) triangle[1][2] = maxArea;\n      else maxArea = triangle[1][2];\n\n      if (previous) {\n        previous.next = next;\n        previous[2] = triangle[2];\n        update(previous);\n      }\n\n      if (next) {\n        next.previous = previous;\n        next[0] = triangle[0];\n        update(next);\n      }\n    }\n\n    topology.arcs.forEach(function(arc) {\n      arc.forEach(relative);\n    });\n\n    function update(triangle) {\n      heap.remove(triangle);\n      triangle[1][2] = triangleArea(triangle);\n      heap.push(triangle);\n    }\n\n    return topology;\n  };\n\n  function cartesianArea(triangle) {\n    return Math.abs(\n      (triangle[0][0] - triangle[2][0]) * (triangle[1][1] - triangle[0][1])\n      - (triangle[0][0] - triangle[1][0]) * (triangle[2][1] - triangle[0][1])\n    );\n  }\n\n  function compareArea(a, b) {\n    return a[1][2] - b[1][2];\n  }\n\n  function minHeap(compare) {\n    var heap = {},\n        array = [];\n\n    heap.push = function() {\n      for (var i = 0, n = arguments.length; i < n; ++i) {\n        var object = arguments[i];\n        up(object.index = array.push(object) - 1);\n      }\n      return array.length;\n    };\n\n    heap.pop = function() {\n      var removed = array[0],\n          object = array.pop();\n      if (array.length) {\n        array[object.index = 0] = object;\n        down(0);\n      }\n      return removed;\n    };\n\n    heap.remove = function(removed) {\n      var i = removed.index,\n          object = array.pop();\n      if (i !== array.length) {\n        array[object.index = i] = object;\n        (compare(object, removed) < 0 ? up : down)(i);\n      }\n      return i;\n    };\n\n    function up(i) {\n      var object = array[i];\n      while (i > 0) {\n        var up = ((i + 1) >> 1) - 1,\n            parent = array[up];\n        if (compare(object, parent) >= 0) break;\n        array[parent.index = i] = parent;\n        array[object.index = i = up] = object;\n      }\n    }\n\n    function down(i) {\n      var object = array[i];\n      while (true) {\n        var right = (i + 1) << 1,\n            left = right - 1,\n            down = i,\n            child = array[down];\n        if (left < array.length && compare(array[left], child) < 0) child = array[down = left];\n        if (right < array.length && compare(array[right], child) < 0) child = array[down = right];\n        if (down === i) break;\n        array[child.index = i] = child;\n        array[object.index = i = down] = object;\n      }\n    }\n\n    return heap;\n  }\n\n  function transformAbsolute(transform) {\n    if (!transform) return noop;\n    var x0,\n        y0,\n        kx = transform.scale[0],\n        ky = transform.scale[1],\n        dx = transform.translate[0],\n        dy = transform.translate[1];\n    return function(point, i) {\n      if (!i) x0 = y0 = 0;\n      point[0] = (x0 += point[0]) * kx + dx;\n      point[1] = (y0 += point[1]) * ky + dy;\n    };\n  }\n\n  function transformRelative(transform) {\n    if (!transform) return noop;\n    var x0,\n        y0,\n        kx = transform.scale[0],\n        ky = transform.scale[1],\n        dx = transform.translate[0],\n        dy = transform.translate[1];\n    return function(point, i) {\n      if (!i) x0 = y0 = 0;\n      var x1 = (point[0] - dx) / kx | 0,\n          y1 = (point[1] - dy) / ky | 0;\n      point[0] = x1 - x0;\n      point[1] = y1 - y0;\n      x0 = x1;\n      y0 = y1;\n    };\n  }\n\n  function noop() {}\n\n  return {\n    version: "1.4.5",\n    mesh: mesh,\n    feature: featureOrCollection,\n    neighbors: neighbors,\n    presimplify: presimplify\n  };\n})();\n')();
i.topology=e("./lib/topojson/topology");i.simplify=e("./lib/topojson/simplify");i.clockwise=e("./lib/topojson/clockwise");i.filter=e("./lib/topojson/filter");i.prune=e("./lib/topojson/prune");i.bind=e("./lib/topojson/bind")},{"./lib/topojson/bind":66,"./lib/topojson/clockwise":69,"./lib/topojson/filter":73,"./lib/topojson/prune":76,"./lib/topojson/simplify":78,"./lib/topojson/topology":81,fs:49}],66:[function(e,t,r){var n=e("./type"),i=e("../../");t.exports=function(e,t){var r=n({geometry:function(e){var r=e.properties,n=t[e.id];if(n){if(r)for(var i in n)r[i]=n[i];else for(var i in n){e.properties=n;break}}this.defaults.geometry.call(this,e)},LineString:a,MultiLineString:a,Point:a,MultiPoint:a,Polygon:a,MultiPolygon:a});for(var i in e.objects){r.object(e.objects[i])}};function a(){}},{"../../":"BOmyIj","./type":91}],67:[function(e,t,r){t.exports=function(e){var t=Infinity,r=Infinity,n=-Infinity,i=-Infinity;function a(e){if(e&&o.hasOwnProperty(e.type))o[e.type](e)}var o={GeometryCollection:function(e){e.geometries.forEach(a)},Point:function(e){s(e.coordinates)},MultiPoint:function(e){e.coordinates.forEach(s)},LineString:function(e){l(e.coordinates)},MultiLineString:function(e){e.coordinates.forEach(l)},Polygon:function(e){e.coordinates.forEach(l)},MultiPolygon:function(e){e.coordinates.forEach(u)}};function s(e){var a=e[0],o=e[1];if(a<t)t=a;if(a>n)n=a;if(o<r)r=o;if(o>i)i=o}function l(e){e.forEach(s)}function u(e){e.forEach(l)}for(var c in e){a(e[c])}return[t,r,n,i]}},{}],68:[function(e,t,r){r.name="cartesian";r.formatDistance=n;r.ringArea=i;r.absoluteArea=Math.abs;r.triangleArea=a;r.distance=o;function n(e){return e.toString()}function i(e){var t=0,r=e.length,n=e[r-1][1]*e[0][0]-e[r-1][0]*e[0][1];while(++t<r){n+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1]}return-n*.5}function a(e){return Math.abs((e[0][0]-e[2][0])*(e[1][1]-e[0][1])-(e[0][0]-e[1][0])*(e[2][1]-e[0][1]))}function o(e,t,r,n){var i=e-r,a=t-n;return Math.sqrt(i*i+a*a)}},{}],69:[function(e,t,r){var n=e("./type"),i=e("./coordinate-systems"),a=e("../../");t.exports=function(e,t){if(e.type==="Topology")s(e,t);else o(e,t)};function o(e,t){var r=null;if(t)"coordinate-system"in t&&(r=i[t["coordinate-system"]]);var a=l(r.ringArea,o);n({LineString:u,MultiLineString:u,Point:u,MultiPoint:u,Polygon:function(e){a(e.coordinates)},MultiPolygon:function(e){e.coordinates.forEach(a)}}).object(e);function o(e){e.reverse()}}function s(e,t){var r=null;if(t)"coordinate-system"in t&&(r=i[t["coordinate-system"]]);var o=l(f,d);var s=n({LineString:u,MultiLineString:u,Point:u,MultiPoint:u,Polygon:function(e){o(e.arcs)},MultiPolygon:function(e){e.arcs.forEach(o)}});for(var c in e.objects){s.object(e.objects[c])}function f(t){return r.ringArea(a.feature(e,{type:"Polygon",arcs:[t]}).geometry.coordinates[0])}function d(e){var t=-1,r=e.length;e.reverse();while(++t<r)e[t]=~e[t]}}function l(e,t){return function(r){if(!(n=r.length))return;var n,i=new Array(n),a=-Infinity,o,s,l;for(var u=0;u<n;++u){var s=Math.abs(i[u]=e(r[u]));if(s>a)a=s,o=u}if(o){l=r[o],r[o]=r[0],r[0]=l;l=i[o],i[o]=i[0],i[0]=l}if(i[0]<0)t(r[0]);for(var u=1;u<n;++u){if(i[u]>0)t(r[u])}}}function u(){}},{"../../":"BOmyIj","./coordinate-systems":71,"./type":91}],70:[function(e,t,r){t.exports=function(e,t){if(arguments.length<2)t=function(e){return e.id};function r(e){if(e&&i.hasOwnProperty(e.type))i[e.type](e)}function n(e){var r=t(e);if(r==null)delete e.id;else e.id=r}var i={Feature:n,FeatureCollection:function(e){e.features.forEach(n)}};for(var a in e){r(e[a])}return e}},{}],71:[function(e,t,r){t.exports={cartesian:e("./cartesian"),spherical:e("./spherical")}},{"./cartesian":68,"./spherical":79}],72:[function(e,t,r){t.exports=function(e){var t=e.arcs,r=-1,n=t.length;while(++r<n){var i=t[r],a=0,o=i.length,s=i[0],l=s[0],u=s[1],c,f;while(++a<o){s=i[a];c=s[0];f=s[1];i[a]=[c-l,f-u];l=c;u=f}}return e}},{}],73:[function(e,t,r){var n=e("./type"),i=e("./prune"),a=e("./clockwise"),o=e("./coordinate-systems"),s=e("../../");t.exports=function(e,t){var r=null,u=true,c;if(t)"coordinate-system"in t&&(r=o[t["coordinate-system"]]),"minimum-area"in t&&(c=+t["minimum-area"]),"force-clockwise"in t&&(u=!!t["force-clockwise"]);if(u)a(e,t);if(!(c>0))c=Number.MIN_VALUE;var f=n({LineString:l,MultiLineString:l,Point:l,MultiPoint:l,Polygon:function(e){e.arcs=e.arcs.filter(h);if(!e.arcs.length){e.type=null;delete e.arcs}},MultiPolygon:function(e){e.arcs=e.arcs.map(function(e){return e.filter(h)}).filter(function(e){return e.length});if(!e.arcs.length){e.type=null;delete e.arcs}},GeometryCollection:function(e){this.defaults.GeometryCollection.call(this,e);e.geometries=e.geometries.filter(function(e){return e.type!=null});if(!e.geometries.length){e.type=null;delete e.geometries}}});for(var d in e.objects){f.object(e.objects[d])}i(e,t);function h(t){var n={type:"Polygon",arcs:[t]},i=s.feature(e,n),a=i.geometry.coordinates[0],o=r.absoluteArea(r.ringArea(a));return o>=c}};function l(){}},{"../../":"BOmyIj","./clockwise":69,"./coordinate-systems":71,"./prune":76,"./type":91}],74:[function(e,t,r){t.exports=function(e){function t(e){return(e&&i.hasOwnProperty(e.type)?i[e.type]:n)(e)}function r(e){var t=e.geometry;if(t==null){e.type=null}else{n(t);e.type=t.type;if(t.geometries)e.geometries=t.geometries;else if(t.coordinates)e.coordinates=t.coordinates}delete e.geometry;return e}function n(e){if(!e)return{type:null};if(a.hasOwnProperty(e.type))a[e.type](e);return e}var i={Feature:r,FeatureCollection:function(e){e.type="GeometryCollection";e.geometries=e.features;e.features.forEach(r);delete e.features;return e}};var a={GeometryCollection:function(e){var t=e.geometries,r=-1,i=t.length;while(++r<i)t[r]=n(t[r])},MultiPoint:function(e){if(!e.coordinates.length){e.type=null;delete e.coordinates}else if(e.coordinates.length<2){e.type="Point";e.coordinates=e.coordinates[0]}},LineString:function(e){if(!e.coordinates.length){e.type=null;delete e.coordinates}},MultiLineString:function(e){for(var t=e.coordinates,r=0,n=0,i=t.length;r<i;++r){var a=t[r];if(a.length)t[n++]=a}if(!n){e.type=null;delete e.coordinates}else if(n<2){e.type="LineString";e.coordinates=t[0]}else{e.coordinates.length=n}},Polygon:function(e){for(var t=e.coordinates,r=0,n=0,i=t.length;r<i;++r){var a=t[r];if(a.length)t[n++]=a}if(!n){e.type=null;delete e.coordinates}else{e.coordinates.length=n}},MultiPolygon:function(e){for(var t=e.coordinates,r=0,n=0,i=t.length;r<i;++r){for(var a=t[r],o=0,s=0,l=a.length;o<l;++o){var u=a[o];if(u.length)a[s++]=u}if(s){a.length=s;t[n++]=a}}if(!n){e.type=null;delete e.coordinates}else if(n<2){e.type="Polygon";e.coordinates=t[0]}else{t.length=n}}};for(var o in e){e[o]=t(e[o])}return e}},{}],75:[function(e,t,r){t.exports=function(e,t){function r(e){if(!e)return{type:null};if(n.hasOwnProperty(e.type))n[e.type](e);return e}var n={GeometryCollection:function(e){var t=e.geometries,n=-1,i=t.length;while(++n<i)t[n]=r(t[n])},Polygon:function(e){for(var r=e.coordinates,n=0,i=0,a=r.length;n<a;++n){var o=r[n];if(t(o))r[i++]=o}if(!i){e.type=null;delete e.coordinates}else{e.coordinates.length=i}},MultiPolygon:function(e){for(var r=e.coordinates,n=0,i=0,a=r.length;n<a;++n){for(var o=r[n],s=0,l=0,u=o.length;s<u;++s){var c=o[s];if(t(c))o[l++]=c}if(l){o.length=l;r[i++]=o}}if(!i){e.type=null;delete e.coordinates}else if(i<2){e.type="Polygon";e.coordinates=r[0]}else{r.length=i}}};for(var i in e){e[i]=r(e[i])}return e}},{}],76:[function(e,t,r){t.exports=function(e,t){var r=false,n=e.objects,i=e.arcs,a=i.length,o=e.arcs=[],s=0,l=new Array(i.length);if(t)"verbose"in t&&(r=!!t["verbose"]);function u(e){if(e&&c.hasOwnProperty(e.type))c[e.type](e)}var c={GeometryCollection:function(e){e.geometries.forEach(u)},LineString:function(e){f(e.arcs)},MultiLineString:function(e){e.arcs.forEach(f)},Polygon:function(e){e.arcs.forEach(f)},MultiPolygon:function(e){e.arcs.forEach(d)}};function f(e){for(var t=0,r=0,n=e.length;t<n;++t){var a=e[t],u=a<0&&(a=~a,true),c=i[a],f;if(c.length<3&&!c[1][0]&&!c[1][1])continue;if((f=l[a])==null){l[a]=f=s++;o[f]=i[a]}e[r++]=u?~f:f}if(!(e.length=r)&&n){if((f=l[a])==null){l[a]=f=s++;o[f]=i[a]}e[0]=u?~f:f}}function d(e){e.forEach(f)}for(var h in n){u(n[h])}if(r)console.warn("prune: retained "+s+" / "+a+" arcs ("+Math.round(s/a*100)+"%)");return e};function n(){}},{}],77:[function(e,t,r){t.exports=function(e,t,r){var n=isFinite(t[0])?t[0]:0,i=isFinite(t[1])?t[1]:0,a=isFinite(t[2])?t[2]:0,o=isFinite(t[3])?t[3]:0,s=a-n?(r-1)/(a-n):1,l=o-i?(r-1)/(o-i):1;function u(e){if(e&&c.hasOwnProperty(e.type))c[e.type](e)}var c={GeometryCollection:function(e){e.geometries.forEach(u)},Point:function(e){f(e.coordinates)},MultiPoint:function(e){e.coordinates.forEach(f)},LineString:function(e){var t=e.coordinates;d(t);if(t.length<2)t[1]=t[0]},MultiLineString:function(e){for(var t=e.coordinates,r=0,n=t.length;r<n;++r){var i=t[r];d(i);if(i.length<2)i[1]=i[0]}},Polygon:function(e){for(var t=e.coordinates,r=0,n=t.length;r<n;++r){var i=t[r];d(i);while(i.length<4)i.push(i[0])}},MultiPolygon:function(e){for(var t=e.coordinates,r=0,n=t.length;r<n;++r){for(var i=t[r],a=0,o=i.length;a<o;++a){var s=i[a];d(s);while(s.length<4)s.push(s[0])}}}};function f(e){e[0]=Math.round((e[0]-n)*s);e[1]=Math.round((e[1]-i)*l)}function d(e){var t=0,r=1,a=e.length,o=e[0],u,c=o[0]=Math.round((o[0]-n)*s),f=o[1]=Math.round((o[1]-i)*l),d,h;while(++t<a){o=e[t];d=Math.round((o[0]-n)*s);h=Math.round((o[1]-i)*l);if(d!==c||h!==f){u=e[r++];u[0]=c=d;u[1]=f=h}}e.length=r}for(var h in e){u(e[h])}return{scale:[1/s,1/l],translate:[n,i]}}},{}],78:[function(e,t,r){var n=e("../../"),i=e("./coordinate-systems");t.exports=function(e,t){var r=0,a,o=false,s=null,l=e.arcs.reduce(function(e,t){return e+t.length},0),u=0;if(t)"minimum-area"in t&&(r=+t["minimum-area"]),"coordinate-system"in t&&(s=i[t["coordinate-system"]]),"retain-proportion"in t&&(a=+t["retain-proportion"]),"verbose"in t&&(o=!!t["verbose"]);n.presimplify(e,s.triangleArea);if(a){var c=[];e.arcs.forEach(function(e){e.forEach(function(e){c.push(e[2])})});t["minimum-area"]=r=l?c.sort(function(e,t){return t-e})[Math.ceil((l-1)*a)]:0;if(o)console.warn("simplification: effective minimum area "+r.toPrecision(3))}e.arcs.forEach(e.transform?function(e){var t=0,n=0,i=-1,a=-1,o=e.length,s,l;while(++i<o){s=e[i];if(s[2]>=r){l=e[++a];l[0]=s[0]+t;l[1]=s[1]+n;t=n=0}else{t+=s[0];n+=s[1]}}e.length=++a}:function(e){var t=-1,n=-1,i=e.length,a;while(++t<i){a=e[t];if(a[2]>=r){e[++n]=a}}e.length=++n});e.arcs.forEach(function(e){var t=-1,r=e.length;while(++t<r)e[t].length=2;u+=e.length});if(o)console.warn("simplification: retained "+u+" / "+l+" points ("+Math.round(u/l*100)+"%)");return e}},{"../../":"BOmyIj","./coordinate-systems":71}],79:[function(e,t,r){var n=Math.PI,i=n/4,a=n/180;r.name="spherical";r.formatDistance=o;r.ringArea=s;r.absoluteArea=l;r.triangleArea=u;r.distance=f;function o(e){var t=e*6371;return(t>1?t.toFixed(3)+"km":(t*1e3).toPrecision(3)+"m")+" ("+(e*180/Math.PI).toPrecision(3)+"°)"}function s(e){if(!e.length)return 0;var t=0,r=e[0],o=r[0]*a,s=r[1]*a/2+i,l=o,u=Math.cos(s),c=Math.sin(s);for(var f=1,d=e.length;f<d;++f){r=e[f],o=r[0]*a,s=r[1]*a/2+i;var h=o-l,g=Math.cos(s),p=Math.sin(s),y=c*p,m=u*g+y*Math.cos(h),v=y*Math.sin(h);t+=Math.atan2(v,m);l=o,u=g,c=p}return 2*(t>n?t-2*n:t<-n?t+2*n:t)}function l(e){return e<0?e+4*n:e}function u(e){var t=c(e[0],e[1]),r=c(e[1],e[2]),n=c(e[2],e[0]),i=(t+r+n)/2;return 4*Math.atan(Math.sqrt(Math.max(0,Math.tan(i/2)*Math.tan((i-t)/2)*Math.tan((i-r)/2)*Math.tan((i-n)/2))))}function c(e,t){var r=(t[0]-e[0])*a,n=Math.sin(r),i=Math.cos(r),o=Math.sin(e[1]*a),s=Math.cos(e[1]*a),l=Math.sin(t[1]*a),u=Math.cos(t[1]*a),c;return Math.atan2(Math.sqrt((c=u*n)*c+(c=s*l-o*u*i)*c),o*l+s*u*i)}function f(e,t,r,n){e*=a,t*=a,r*=a,n*=a;return 2*Math.asin(Math.sqrt(d(n-t)+Math.cos(t)*Math.cos(n)*d(r-e)))}function d(e){return(e=Math.sin(e/2))*e}},{}],80:[function(e,t,r){var n=e("./type");t.exports=function(e,t){var r=.01,i=-180,a=i+r,o=180,s=o-r,l=-90,u=l+r,c=90,f=c-r,d=[];if(t){var h=t.scale[0],g=t.scale[1],p=t.translate[0],y=t.translate[1];i=Math.round((i-p)/h);o=Math.round((o-p)/h);l=Math.round((l-y)/g);c=Math.round((c-y)/g);a=Math.round((a-p)/h);s=Math.round((s-p)/h);u=Math.round((u-y)/g);f=Math.round((f-y)/g)}function m(e){return e<=u?[0,l]:e>=f?[0,c]:[i,e]}var v=n({polygon:function(e){var t=[];for(var r=0,n=e.length;r<n;++r){var i=e[r],o=[];o.push(i);for(var l=0,c=i.length;l<c;++l){var d=i[l],h=d[0],g=d[1];if(h<=a||h>=s||g<=u||g>=f){for(var p=l+1;p<c;++p){var y=i[p],v=y[0],w=y[1];if(v>a&&v<s&&w>u&&w<f)break}if(p===l+1)continue;if(l){var b=i.slice(0,l+1);b[b.length-1]=m(g);o[o.length-1]=b}else{o.pop()}if(p>=c)break;o.push(i=i.slice(p-1));i[0]=m(i[0][1]);l=-1;c=i.length}}var x={},k={};for(var l=0,c=o.length;l<c;++l){var $=o[l],S=$[0],L=$[$.length-1];if(S[0]===L[0]&&S[1]===L[1]){t.push($);o[l]=null;continue}$.index=l;x[S]=k[L]=$}for(var l=0;l<c;++l){var $=o[l];if($){var S=$[0],L=$[$.length-1],E=k[S],C=x[L];delete x[S];delete k[L];if(S[0]===L[0]&&S[1]===L[1]){t.push($);continue}if(E){delete k[S];delete x[E[0]];E.pop();o[E.index]=null;$=E.concat($);if(E===C){t.push($)}else{$.index=c++;o.push(x[$[0]]=k[$[$.length-1]]=$)}}else if(C){delete x[L];delete k[C[C.length-1]];$.pop();$=$.concat(C);$.index=c++;o[C.index]=null;o.push(x[$[0]]=k[$[$.length-1]]=$)}else{$.push($[0]);t.push($)}}}}for(var l=0,c=e.length=t.length;l<c;++l){e[l]=t[l]}}});for(var w in e){v.object(e[w])}}},{"./type":91}],81:[function(e,t,r){var n=e("./type"),i=e("./stitch"),a=e("./coordinate-systems"),o=e("./topology/index"),s=e("./delta"),l=e("./geomify"),u=e("./prefilter"),c=e("./quantize"),f=e("./bounds"),d=e("./compute-id"),h=e("./transform-properties");var g=1e-6;t.exports=function(e,t){var r=1e4,n=function(e){return e.id},p=function(){},y,m=0,v=true,w=false,b=null;if(t)"verbose"in t&&(w=!!t["verbose"]),"stitch-poles"in t&&(v=!!t["stitch-poles"]),"coordinate-system"in t&&(b=a[t["coordinate-system"]]),"minimum-area"in t&&(m=+t["minimum-area"]),"quantization"in t&&(r=+t["quantization"]),"id"in t&&(n=t["id"]),"property-transform"in t&&(p=t["property-transform"]);d(e,n);h(e,p);l(e);var x=f(e);var k=x[0]<-180-g||x[1]<-90-g||x[2]>180+g||x[3]>90+g;if(!b){b=a[k?"cartesian":"spherical"];if(t)t["coordinate-system"]=b.name}if(b===a.spherical){if(k)throw new Error("spherical coordinates outside of [±180°, ±90°]");if(x[0]<-180+g)x[0]=-180;if(x[1]<-90+g)x[1]=-90;if(x[2]>180-g)x[2]=180;if(x[3]>90-g)x[3]=90}if(w){console.warn("bounds: "+x.join(" ")+" ("+b.name+")")}if(m)u(e,function(e){return b.absoluteArea(b.ringArea(e))>=m});if(r){y=c(e,x,r);if(w){console.warn("quantization: "+y.scale.map(function(e){return b.formatDistance(e/180*Math.PI)}).join(" "))}}if(b===a.spherical&&v){i(e,y)}var $=o(e);$.bbox=x;if(w){console.warn("topology: "+$.arcs.length+" arcs, "+$.arcs.reduce(function(e,t){return e+t.length},0)+" points")}if(r)$.transform=y,s($);return $}},{"./bounds":67,"./compute-id":70,"./coordinate-systems":71,"./delta":72,"./geomify":74,"./prefilter":75,"./quantize":77,"./stitch":80,"./topology/index":86,"./transform-properties":90,"./type":91}],82:[function(e,t,r){var n=e("./join");t.exports=function(e){var t=n(e),r=e.coordinates,a=e.lines,o=e.rings;for(var s=0,l=a.length;s<l;++s){var u=a[s],c=u[0],f=u[1];while(++c<f){if(t.get(r[c])){var d={0:c,1:u[1]};u[1]=c;u=u.next=d}}}for(var s=0,l=o.length;s<l;++s){var h=o[s],g=h[0],p=g,y=h[1],m=t.get(r[g]);while(++p<y){if(t.get(r[p])){if(m){var d={0:p,1:h[1]};h[1]=p;h=h.next=d}else{i(r,g,y,y-p);r[y]=r[g];m=true;p=g}}}}return e};function i(e,t,r,n){a(e,t,r);a(e,t,t+n);a(e,t+n,r)}function a(e,t,r){for(var n=t+(r-- -t>>1),i;t<n;++t,--r){i=e[t],e[t]=e[r],e[r]=i}}},{"./join":87}],83:[function(e,t,r){var n=e("./join"),i=e("./hashtable"),a=e("./point-hash"),o=e("./point-equal");t.exports=function(e){var t=e.coordinates,r=e.lines,n=e.rings,s=r.length+n.length;delete e.lines;delete e.rings;for(var l=0,u=r.length;l<u;++l){var c=r[l];while(c=c.next)++s}for(var l=0,u=n.length;l<u;++l){var f=n[l];while(f=f.next)++s}var d=i(s*2,a,o),h=e.arcs=[];for(var l=0,u=r.length;l<u;++l){var c=r[l];do{g(c)}while(c=c.next)}for(var l=0,u=n.length;l<u;++l){var f=n[l];if(f.next){do{g(f)}while(f=f.next)}else{p(f)}}function g(e){var r,n,i,a;if(i=d.get(r=t[e[0]])){for(var o=0,s=i.length;o<s;++o){var l=i[o];if(y(l,e)){e[0]=l[0];e[1]=l[1];return}}}if(a=d.get(n=t[e[1]])){for(var o=0,s=a.length;o<s;++o){var u=a[o];if(m(u,e)){e[1]=u[0];e[0]=u[1];return}}}if(i)i.push(e);else d.set(r,[e]);if(a)a.push(e);else d.set(n,[e]);h.push(e)}function p(e){var r,n;if(n=d.get(r=t[e[0]])){for(var i=0,a=n.length;i<a;++i){var o=n[i];if(v(o,e)){e[0]=o[0];e[1]=o[1];return}if(w(o,e)){e[0]=o[1];e[1]=o[0];return}}}if(n=d.get(r=t[e[0]+b(e)])){for(var i=0,a=n.length;i<a;++i){var o=n[i];if(v(o,e)){e[0]=o[0];e[1]=o[1];return}if(w(o,e)){e[0]=o[1];e[1]=o[0];return}}}if(n)n.push(e);else d.set(r,[e]);h.push(e)}function y(e,r){var n=e[0],i=r[0],a=e[1],s=r[1];if(n-a!==i-s)return false;for(;n<=a;++n,++i)if(!o(t[n],t[i]))return false;return true}function m(e,r){var n=e[0],i=r[0],a=e[1],s=r[1];if(n-a!==i-s)return false;for(;n<=a;++n,--s)if(!o(t[n],t[s]))return false;return true}function v(e,r){var n=e[0],i=r[0],a=e[1],s=r[1],l=a-n;if(l!==s-i)return false;var u=b(e),c=b(r);for(var f=0;f<l;++f){if(!o(t[n+(f+u)%l],t[i+(f+c)%l]))return false}return true}function w(e,r){var n=e[0],i=r[0],a=e[1],s=r[1],l=a-n;if(l!==s-i)return false;var u=b(e),c=l-b(r);for(var f=0;f<l;++f){if(!o(t[n+(f+u)%l],t[s-(f+c)%l]))return false}return true}function b(e){var r=e[0],n=e[1],i=r,a=i,o=t[i];while(++i<n){var s=t[i];if(s[0]<o[0]||s[0]===o[0]&&s[1]<o[1]){a=i;o=s}}return a-r}return e}},{"./hashtable":85,"./join":87,"./point-equal":88,"./point-hash":89}],84:[function(e,t,r){t.exports=function(e){var t=-1,r=[],n=[],i=[];function a(e){if(e&&o.hasOwnProperty(e.type))o[e.type](e)}var o={GeometryCollection:function(e){e.geometries.forEach(a)},LineString:function(e){e.arcs=s(e.coordinates);delete e.coordinates},MultiLineString:function(e){e.arcs=e.coordinates.map(s);delete e.coordinates},Polygon:function(e){e.arcs=e.coordinates.map(l);delete e.coordinates},MultiPolygon:function(e){e.arcs=e.coordinates.map(u);delete e.coordinates}};function s(e){for(var n=0,a=e.length;n<a;++n)i[++t]=e[n];var o={0:t-a+1,1:t};r.push(o);return o}function l(e){for(var r=0,a=e.length;r<a;++r)i[++t]=e[r];var o={0:t-a+1,1:t};n.push(o);return o}function u(e){return e.map(l)}for(var c in e){a(e[c])}return{type:"Topology",coordinates:i,lines:r,rings:n,objects:e}}},{}],85:[function(e,t,r){t.exports=function(e,t,r){var n=new Array(e=1<<Math.ceil(Math.log(e)/Math.LN2)),i=e-1,a=e;function o(e,o){var s=t(e)&i,l=n[s],u=!s;while(l!=null){if(r(l.key,e))return l.value=o;l=n[s=s+1&i];if(!s&&u++)throw new Error("full hashtable")}n[s]={key:e,value:o};--a;return o}function s(e,a){var o=t(e)&i,s=n[o],l=!o;while(s!=null){if(r(s.key,e))return s.value;s=n[o=o+1&i];if(!o&&l++)break}return a}function l(e){var s=t(e)&i,l=n[s],u=!s;while(l!=null){if(r(l.key,e)){n[s]=null;l=n[s=s+1&i];if(l!=null){++a;n[s]=null;o(l.key,l.value)}++a;return true}l=n[s=s+1&i];if(!s&&u++)break}return false}function u(){var e=[];for(var t=0,r=n.length;t<r;++t){var i=n[t];if(i!=null)e.push(i.key)}return e}return{set:o,get:s,remove:l,keys:u}}},{}],86:[function(e,t,r){var n=e("./hashtable"),i=e("./extract"),a=e("./cut"),o=e("./dedup");t.exports=function(e){var t=o(a(i(e))),r=t.coordinates,u=n(t.arcs.length,s,l);e=t.objects;t.arcs=t.arcs.map(function(e,t){u.set(e,t);return r.slice(e[0],e[1]+1)});delete t.coordinates;r=null;function c(e){if(e&&f.hasOwnProperty(e.type))f[e.type](e)}var f={GeometryCollection:function(e){e.geometries.forEach(c)},LineString:function(e){e.arcs=d(e.arcs)},MultiLineString:function(e){e.arcs=e.arcs.map(d)},Polygon:function(e){e.arcs=e.arcs.map(d)},MultiPolygon:function(e){e.arcs=e.arcs.map(h)}};function d(e){var t=[];do{var r=u.get(e);t.push(e[0]<e[1]?r:~r)}while(e=e.next);return t}function h(e){return e.map(d)}for(var g in e){c(e[g])}return t};function s(e){var t=e[0],r=e[1],n;if(r<t)n=t,t=r,r=n;return t+31*r}function l(e,t){var r=e[0],n=e[1],i=t[0],a=t[1],o;if(n<r)o=r,r=n,n=o;if(a<i)o=i,i=a,a=o;return r===i&&n===a}},{"./cut":82,"./dedup":83,"./extract":84,"./hashtable":85}],87:[function(e,t,r){var n=e("./hashtable"),i=e("./point-hash"),a=e("./point-equal");t.exports=function(e){var t=e.coordinates,r=e.lines,o=e.rings,s,l=n(t.length,i,a),u=n(t.length,i,a);for(var c=0,f=r.length;c<f;++c){var d=r[c],h=d[0],g=d[1],p=null,y=t[h],m=t[++h];s=n(g-h,i,a);u.set(y,true);while(++h<=g){x(p=y,y=m,m=t[h])}u.set(m,true)}for(var c=0,f=o.length;c<f;++c){var v=o[c],w=v[0]+1,b=v[1],p=t[b-1],y=t[w-1],m=t[w];s=n(b-w+1,i,a);x(p,y,m);while(++w<=b){x(p=y,y=m,m=t[w])}}function x(e,t,r){if(s.get(t))return;s.set(t,true);var n=l.get(t);if(n){if(!(a(n[0],e)&&a(n[1],r))&&!(a(n[0],r)&&a(n[1],e))){u.set(t,true)}}else{l.set(t,[e,r])}}return u}},{"./hashtable":85,"./point-equal":88,"./point-hash":89}],88:[function(e,t,r){t.exports=function(e,t){return e[0]===t[0]&&e[1]===t[1]}},{}],89:[function(e,t,r){var n=new ArrayBuffer(8),i=new Float64Array(n),a=new Int32Array(n);function o(e){i[0]=e;e=a[1]^a[0];e^=e>>>20^e>>>12;e^=e>>>7^e>>>4;return e}t.exports=function(e){var t=o(e[0])+31*o(e[1])|0;return t<0?~t:t}},{}],90:[function(e,t,r){t.exports=function(e,t){if(arguments.length<2)t=function(){};function r(e){if(e&&i.hasOwnProperty(e.type))i[e.type](e)}function n(e){if(e.properties){var r=e.properties,n={},i=true;for(var a in r){if(t(n,a,r[a])){i=false}}if(i)delete e.properties;else e.properties=n}}var i={Feature:n,FeatureCollection:function(e){e.features.forEach(n)}};for(var a in e){r(e[a])}return e}},{}],91:[function(e,t,r){t.exports=function(e){for(var t in n){if(!(t in e)){e[t]=n[t]}}e.defaults=n;return e};var n={Feature:function(e){if(e.geometry)this.geometry(e.geometry)},FeatureCollection:function(e){var t=e.features,r=-1,n=t.length;while(++r<n)this.Feature(t[r])},GeometryCollection:function(e){var t=e.geometries,r=-1,n=t.length;while(++r<n)this.geometry(t[r])},LineString:function(e){this.line(e.coordinates)},MultiLineString:function(e){var t=e.coordinates,r=-1,n=t.length;while(++r<n)this.line(t[r])},MultiPoint:function(e){var t=e.coordinates,r=-1,n=t.length;while(++r<n)this.point(t[r])},MultiPolygon:function(e){var t=e.coordinates,r=-1,n=t.length;while(++r<n)this.polygon(t[r])},Point:function(e){this.point(e.coordinates)},Polygon:function(e){this.polygon(e.coordinates)},object:function(e){return e==null?null:a.hasOwnProperty(e.type)?this[e.type](e):this.geometry(e)},geometry:function(e){return e==null?null:i.hasOwnProperty(e.type)?this[e.type](e):null},point:function(){},line:function(e){var t=-1,r=e.length;while(++t<r)this.point(e[t])},polygon:function(e){var t=-1,r=e.length;while(++t<r)this.line(e[t])}};var i={LineString:1,MultiLineString:1,MultiPoint:1,MultiPolygon:1,Point:1,Polygon:1,GeometryCollection:1};var a={Feature:1,FeatureCollection:1}},{}]},{},[1]);